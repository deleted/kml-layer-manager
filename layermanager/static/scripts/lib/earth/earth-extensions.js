/*

 Copyright 2009 Google Inc.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
(function(){function n(){}function q(){}function s(){}function y(){}function E(a,d){return a>d?d+360-a:d-a}function C(a){return a!==null&&(typeof a=="function"||typeof a=="object")&&"getType"in a}var j={isnamespace_:true};if(!("map"in Array.prototype))Array.prototype.map=function(a){var d=this.length;if(typeof a!="function")throw new TypeError("map() requires a mapping function.");for(var f=Array(d),h=arguments[1],c=0;c<d;c++)if(c in this)f[c]=a.call(h,this[c],c,this);return f};j.ALTITUDE_CLAMP_TO_GROUND=
0;j.ALTITUDE_RELATIVE_TO_GROUND=1;j.ALTITUDE_ABSOLUTE=2;j.ALTITUDE_CLAMP_TO_SEA_FLOOR=4;j.ALTITUDE_RELATIVE_TO_SEA_FLOOR=5;var z={precision:1.0E-6};n.prototype={e:function(a){return a<1||a>this.elements.length?null:this.elements[a-1]},dimensions:function(){return this.elements.length},modulus:function(){return Math.sqrt(this.dot(this))},eql:function(a){var d=this.elements.length;a=a.elements||a;if(d!=a.length)return false;for(;d--;)if(Math.abs(this.elements[d]-a[d])>z.precision)return false;return true},
dup:function(){return n.create(this.elements)},map:function(a){var d=[];this.each(function(f,h){d.push(a(f,h))});return n.create(d)},each:function(a){for(var d=this.elements.length,f=0;f<d;f++)a(this.elements[f],f+1)},toUnitVector:function(){var a=this.modulus();if(a===0)return this.dup();return this.map(function(d){return d/a})},angleFrom:function(a){var d=a.elements||a;var f=a=this.elements.length;if(a!=d.length)return null;var h=0,c=0,b=0;this.each(function(e,g){h+=e*d[g-1];c+=e*e;b+=d[g-1]*d[g-
1]});c=Math.sqrt(c);b=Math.sqrt(b);if(c*b===0)return null;a=h/(c*b);if(a<-1)a=-1;if(a>1)a=1;return Math.acos(a)},isParallelTo:function(a){a=this.angleFrom(a);return a===null?null:a<=z.precision},isAntiparallelTo:function(a){a=this.angleFrom(a);return a===null?null:Math.abs(a-Math.PI)<=z.precision},isPerpendicularTo:function(a){a=this.dot(a);return a===null?null:Math.abs(a)<=z.precision},add:function(a){var d=a.elements||a;if(this.elements.length!=d.length)return null;return this.map(function(f,h){return f+
d[h-1]})},subtract:function(a){var d=a.elements||a;if(this.elements.length!=d.length)return null;return this.map(function(f,h){return f-d[h-1]})},multiply:function(a){return this.map(function(d){return d*a})},x:function(a){return this.multiply(a)},dot:function(a){a=a.elements||a;var d=0,f=this.elements.length;if(f!=a.length)return null;for(;f--;)d+=this.elements[f]*a[f];return d},cross:function(a){a=a.elements||a;if(this.elements.length!=3||a.length!=3)return null;var d=this.elements;return n.create([d[1]*
a[2]-d[2]*a[1],d[2]*a[0]-d[0]*a[2],d[0]*a[1]-d[1]*a[0]])},max:function(){for(var a=0,d=this.elements.length;d--;)if(Math.abs(this.elements[d])>Math.abs(a))a=this.elements[d];return a},indexOf:function(a){for(var d=null,f=this.elements.length,h=0;h<f;h++)if(d===null&&this.elements[h]==a)d=h+1;return d},toDiagonalMatrix:function(){return q.Diagonal(this.elements)},round:function(){return this.map(function(a){return Math.round(a)})},snapTo:function(a){return this.map(function(d){return Math.abs(d-a)<=
z.precision?a:d})},distanceFrom:function(a){if(a.anchor||a.start&&a.end)return a.distanceFrom(this);var d=a.elements||a;if(d.length!=this.elements.length)return null;var f=0,h;this.each(function(c,b){h=c-d[b-1];f+=h*h});return Math.sqrt(f)},liesOn:function(a){return a.contains(this)},liesIn:function(a){return a.contains(this)},rotate:function(a,d){var f,h=null,c,b;if(a.determinant)h=a.elements;switch(this.elements.length){case 2:f=d.elements||d;if(f.length!=2)return null;if(!h)h=q.Rotation(a).elements;
c=this.elements[0]-f[0];b=this.elements[1]-f[1];return n.create([f[0]+h[0][0]*c+h[0][1]*b,f[1]+h[1][0]*c+h[1][1]*b]);case 3:if(!d.direction)return null;var e=d.pointClosestTo(this).elements;if(!h)h=q.Rotation(a,d.direction).elements;c=this.elements[0]-e[0];b=this.elements[1]-e[1];f=this.elements[2]-e[2];return n.create([e[0]+h[0][0]*c+h[0][1]*b+h[0][2]*f,e[1]+h[1][0]*c+h[1][1]*b+h[1][2]*f,e[2]+h[2][0]*c+h[2][1]*b+h[2][2]*f]);default:return null}},reflectionIn:function(a){if(a.anchor){var d=this.elements.slice();
a=a.pointClosestTo(d).elements;return n.create([a[0]+(a[0]-d[0]),a[1]+(a[1]-d[1]),a[2]+(a[2]-(d[2]||0))])}else{var f=a.elements||a;if(this.elements.length!=f.length)return null;return this.map(function(h,c){return f[c-1]+(f[c-1]-h)})}},to3D:function(){var a=this.dup();switch(a.elements.length){case 3:break;case 2:a.elements.push(0);break;default:return null}return a},inspect:function(){return"["+this.elements.join(", ")+"]"},setElements:function(a){this.elements=(a.elements||a).slice();return this}};
n.create=function(a){var d=new n;return d.setElements(a)};var l=n.create;n.i=n.create([1,0,0]);n.j=n.create([0,1,0]);n.k=n.create([0,0,1]);n.Random=function(a){for(var d=[];a--;)d.push(Math.random());return n.create(d)};n.Zero=function(a){for(var d=[];a--;)d.push(0);return n.create(d)};q.prototype={e:function(a,d){if(a<1||a>this.elements.length||d<1||d>this.elements[0].length)return null;return this.elements[a-1][d-1]},row:function(a){if(a>this.elements.length)return null;return n.create(this.elements[a-
1])},col:function(a){if(a>this.elements[0].length)return null;for(var d=[],f=this.elements.length,h=0;h<f;h++)d.push(this.elements[h][a-1]);return n.create(d)},dimensions:function(){return{rows:this.elements.length,cols:this.elements[0].length}},rows:function(){return this.elements.length},cols:function(){return this.elements[0].length},eql:function(a){a=a.elements||a;if(typeof a[0][0]=="undefined")a=q.create(a).elements;if(this.elements.length!=a.length||this.elements[0].length!=a[0].length)return false;
for(var d=this.elements.length,f=this.elements[0].length,h;d--;)for(h=f;h--;)if(Math.abs(this.elements[d][h]-a[d][h])>z.precision)return false;return true},dup:function(){return q.create(this.elements)},map:function(a){for(var d=[],f=this.elements.length,h=this.elements[0].length,c;f--;){c=h;for(d[f]=[];c--;)d[f][c]=a(this.elements[f][c],f+1,c+1)}return q.create(d)},isSameSizeAs:function(a){a=a.elements||a;if(typeof a[0][0]=="undefined")a=q.create(a).elements;return this.elements.length==a.length&&
this.elements[0].length==a[0].length},add:function(a){var d=a.elements||a;if(typeof d[0][0]=="undefined")d=q.create(d).elements;if(!this.isSameSizeAs(d))return null;return this.map(function(f,h,c){return f+d[h-1][c-1]})},subtract:function(a){var d=a.elements||a;if(typeof d[0][0]=="undefined")d=q.create(d).elements;if(!this.isSameSizeAs(d))return null;return this.map(function(f,h,c){return f-d[h-1][c-1]})},canMultiplyFromLeft:function(a){a=a.elements||a;if(typeof a[0][0]=="undefined")a=q.create(a).elements;
return this.elements[0].length==a.length},multiply:function(a){if(!a.elements)return this.map(function(m){return m*a});var d=a.modulus?true:false,f=a.elements||a;if(typeof f[0][0]=="undefined")f=q.create(f).elements;if(!this.canMultiplyFromLeft(f))return null;for(var h=this.elements.length,c=f[0].length,b,e=this.elements[0].length,g,i=[],k;h--;){b=c;for(i[h]=[];b--;){g=e;for(k=0;g--;)k+=this.elements[h][g]*f[g][b];i[h][b]=k}}f=q.create(i);return d?f.col(1):f},x:function(a){return this.multiply(a)},
minor:function(a,d,f,h){for(var c=[],b=f,e,g,i,k=this.elements.length,m=this.elements[0].length;b--;){e=f-b-1;c[e]=[];for(g=h;g--;){i=h-g-1;c[e][i]=this.elements[(a+e-1)%k][(d+i-1)%m]}}return q.create(c)},transpose:function(){var a=this.elements.length,d;d=this.elements[0].length;var f,h=[];for(d=d;d--;){f=a;for(h[d]=[];f--;)h[d][f]=this.elements[f][d]}return q.create(h)},isSquare:function(){return this.elements.length==this.elements[0].length},max:function(){for(var a=0,d=this.elements.length,f=
this.elements[0].length,h;d--;)for(h=f;h--;)if(Math.abs(this.elements[d][h])>Math.abs(a))a=this.elements[d][h];return a},indexOf:function(a){var d=null;d=this.elements.length;var f,h=this.elements[0].length,c;for(f=0;f<d;f++)for(c=0;c<h;c++)if(this.elements[f][c]==a)return{i:f+1,j:c+1};return null},diagonal:function(){if(!this.isSquare)return null;for(var a=[],d=this.elements.length,f=0;f<d;f++)a.push(this.elements[f][f]);return n.create(a)},toRightTriangular:function(){var a=this.dup(),d,f=this.elements.length,
h,c,b=this.elements[0].length,e;for(h=0;h<f;h++){if(a.elements[h][h]==0)for(c=h+1;c<f;c++)if(a.elements[c][h]!=0){d=[];for(e=0;e<b;e++)d.push(a.elements[h][e]+a.elements[c][e]);a.elements[h]=d;break}if(a.elements[h][h]!=0)for(c=h+1;c<f;c++){var g=a.elements[c][h]/a.elements[h][h];d=[];for(e=0;e<b;e++)d.push(e<=h?0:a.elements[c][e]-a.elements[h][e]*g);a.elements[c]=d}}return a},toUpperTriangular:function(){return this.toRightTriangular()},determinant:function(){if(!this.isSquare())return null;for(var a=
this.toRightTriangular(),d=a.elements[0][0],f=a.elements.length,h=1;h<f;h++)d*=a.elements[h][h];return d},det:function(){return this.determinant()},isSingular:function(){return this.isSquare()&&this.determinant()===0},trace:function(){if(!this.isSquare())return null;for(var a=this.elements[0][0],d=this.elements.length,f=1;f<d;f++)a+=this.elements[f][f];return a},tr:function(){return this.trace()},rank:function(){for(var a=this.toRightTriangular(),d=0,f=this.elements.length,h=this.elements[0].length,
c;f--;)for(c=h;c--;)if(Math.abs(a.elements[f][c])>z.precision){d++;break}return d},rk:function(){return this.rank()},augment:function(a){a=a.elements||a;if(typeof a[0][0]=="undefined")a=q.create(a).elements;var d=this.dup(),f=d.elements[0].length,h=d.elements.length,c=a[0].length,b;if(h!=a.length)return null;for(;h--;)for(b=c;b--;)d.elements[h][f+b]=a[h][b];return d},inverse:function(){if(!this.isSquare()||this.isSingular())return null;for(var a=this.elements.length,d=a,f,h=this.augment(q.I(a)).toRightTriangular(),
c=h.elements[0].length,b,e,g=[],i;d--;){e=[];g[d]=[];f=h.elements[d][d];for(b=0;b<c;b++){i=h.elements[d][b]/f;e.push(i);b>=a&&g[d].push(i)}h.elements[d]=e;for(f=d;f--;){e=[];for(b=0;b<c;b++)e.push(h.elements[f][b]-h.elements[d][b]*h.elements[f][d]);h.elements[f]=e}}return q.create(g)},inv:function(){return this.inverse()},round:function(){return this.map(function(a){return Math.round(a)})},snapTo:function(a){return this.map(function(d){return Math.abs(d-a)<=z.precision?a:d})},inspect:function(){for(var a=
[],d=this.elements.length,f=0;f<d;f++)a.push(n.create(this.elements[f]).inspect());return a.join("\n")},setElements:function(a){var d,f=a.elements||a;if(typeof f[0][0]!="undefined"){a=f.length;for(this.elements=[];a--;){d=f[a].length;for(this.elements[a]=[];d--;)this.elements[a][d]=f[a][d]}return this}d=f.length;this.elements=[];for(a=0;a<d;a++)this.elements.push([f[a]]);return this}};q.create=function(a){var d=new q;return d.setElements(a)};l=q.create;q.I=function(a){for(var d=[],f=a,h;f--;){h=a;
for(d[f]=[];h--;)d[f][h]=f==h?1:0}return q.create(d)};q.Diagonal=function(a){for(var d=a.length,f=q.I(d);d--;)f.elements[d][d]=a[d];return f};q.Rotation=function(a,d){if(!d)return q.create([[Math.cos(a),-Math.sin(a)],[Math.sin(a),Math.cos(a)]]);var f=d.dup();if(f.elements.length!=3)return null;var h=f.modulus(),c=f.elements[0]/h,b=f.elements[1]/h;f=f.elements[2]/h;h=Math.sin(a);var e=Math.cos(a),g=1-e;return q.create([[g*c*c+e,g*c*b-h*f,g*c*f+h*b],[g*c*b+h*f,g*b*b+e,g*b*f-h*c],[g*c*f-h*b,g*b*f+h*
c,g*f*f+e]])};q.RotationX=function(a){var d=Math.cos(a);a=Math.sin(a);return q.create([[1,0,0],[0,d,-a],[0,a,d]])};q.RotationY=function(a){var d=Math.cos(a);a=Math.sin(a);return q.create([[d,0,a],[0,1,0],[-a,0,d]])};q.RotationZ=function(a){var d=Math.cos(a);a=Math.sin(a);return q.create([[d,-a,0],[a,d,0],[0,0,1]])};q.Random=function(a,d){return q.Zero(a,d).map(function(){return Math.random()})};q.Zero=function(a,d){for(var f=[],h=a,c;h--;){c=d;for(f[h]=[];c--;)f[h][c]=0}return q.create(f)};s.prototype=
{eql:function(a){return this.isParallelTo(a)&&this.contains(a.anchor)},dup:function(){return s.create(this.anchor,this.direction)},translate:function(a){a=a.elements||a;return s.create([this.anchor.elements[0]+a[0],this.anchor.elements[1]+a[1],this.anchor.elements[2]+(a[2]||0)],this.direction)},isParallelTo:function(a){if(a.normal||a.start&&a.end)return a.isParallelTo(this);a=this.direction.angleFrom(a.direction);return Math.abs(a)<=z.precision||Math.abs(a-Math.PI)<=z.precision},distanceFrom:function(a){if(a.normal||
a.start&&a.end)return a.distanceFrom(this);if(a.direction){if(this.isParallelTo(a))return this.distanceFrom(a.anchor);var d=this.direction.cross(a.direction).toUnitVector().elements,f=this.anchor.elements;a=a.anchor.elements;return Math.abs((f[0]-a[0])*d[0]+(f[1]-a[1])*d[1]+(f[2]-a[2])*d[2])}else{var h=a.elements||a;f=this.anchor.elements;d=this.direction.elements;a=h[0]-f[0];var c=h[1]-f[1];h=(h[2]||0)-f[2];f=Math.sqrt(a*a+c*c+h*h);if(f===0)return 0;d=(a*d[0]+c*d[1]+h*d[2])/f;d=1-d*d;return Math.abs(f*
Math.sqrt(d<0?0:d))}},contains:function(a){if(a.start&&a.end)return this.contains(a.start)&&this.contains(a.end);a=this.distanceFrom(a);return a!==null&&a<=z.precision},positionOf:function(a){if(!this.contains(a))return null;a=a.elements||a;var d=this.anchor.elements,f=this.direction.elements;return(a[0]-d[0])*f[0]+(a[1]-d[1])*f[1]+((a[2]||0)-d[2])*f[2]},liesIn:function(a){return a.contains(this)},intersects:function(a){if(a.normal)return a.intersects(this);return!this.isParallelTo(a)&&this.distanceFrom(a)<=
z.precision},intersectionWith:function(a){if(a.normal||a.start&&a.end)return a.intersectionWith(this);if(!this.intersects(a))return null;var d=this.anchor.elements,f=this.direction.elements,h=a.anchor.elements,c=a.direction.elements;a=f[0];var b=f[1];f=f[2];var e=c[0],g=c[1];c=c[2];var i=d[0]-h[0],k=d[1]-h[1],m=d[2]-h[2];h=-a*i-b*k-f*m;i=e*i+g*k+c*m;k=a*a+b*b+f*f;m=e*e+g*g+c*c;e=a*e+b*g+f*c;e=(h*m/k+e*i)/(m-e*e);return n.create([d[0]+e*a,d[1]+e*b,d[2]+e*f])},pointClosestTo:function(a){if(a.start&&
a.end){a=a.pointClosestTo(this);return a===null?null:this.pointClosestTo(a)}else if(a.direction){if(this.intersects(a))return this.intersectionWith(a);if(this.isParallelTo(a))return null;var d=this.direction.elements,f=a.direction.elements,h=d[0],c=d[1];d=d[2];var b=f[0],e=f[1],g=f[2];f=d*b-h*g;var i=h*e-c*b,k=c*g-d*e;h=[f*g-i*e,i*b-k*g,k*e-f*b];a=y.create(a.anchor,h);return a.intersectionWith(this)}else{a=a.elements||a;if(this.contains(a))return n.create(a);f=this.anchor.elements;d=this.direction.elements;
h=d[0];c=d[1];d=d[2];b=f[0];i=f[1];e=f[2];f=h*(a[1]-i)-c*(a[0]-b);i=c*((a[2]||0)-e)-d*(a[1]-i);k=d*(a[0]-b)-h*((a[2]||0)-e);h=n.create([c*f-d*k,d*i-h*f,h*k-c*i]);c=this.distanceFrom(a)/h.modulus();return n.create([a[0]+h.elements[0]*c,a[1]+h.elements[1]*c,(a[2]||0)+h.elements[2]*c])}},rotate:function(a,d){if(typeof d.direction=="undefined")d=s.create(d.to3D(),n.k);var f=q.Rotation(a,d.direction).elements,h=d.pointClosestTo(this.anchor).elements,c=this.anchor.elements,b=this.direction.elements,e=h[0],
g=h[1];h=h[2];var i=c[0],k=c[1];c=c[2];i=i-e;k=k-g;c=c-h;return s.create([e+f[0][0]*i+f[0][1]*k+f[0][2]*c,g+f[1][0]*i+f[1][1]*k+f[1][2]*c,h+f[2][0]*i+f[2][1]*k+f[2][2]*c],[f[0][0]*b[0]+f[0][1]*b[1]+f[0][2]*b[2],f[1][0]*b[0]+f[1][1]*b[1]+f[1][2]*b[2],f[2][0]*b[0]+f[2][1]*b[1]+f[2][2]*b[2]])},reverse:function(){return s.create(this.anchor,this.direction.x(-1))},reflectionIn:function(a){if(a.normal){var d=this.anchor.elements,f=this.direction.elements,h=d[0],c=d[1];d=d[2];var b=f[0],e=f[1],g=f[2];f=
this.anchor.reflectionIn(a).elements;h=h+b;c=c+e;d=d+g;a=a.pointClosestTo([h,c,d]).elements;a=[a[0]+(a[0]-h)-f[0],a[1]+(a[1]-c)-f[1],a[2]+(a[2]-d)-f[2]];return s.create(f,a)}else if(a.direction)return this.rotate(Math.PI,a);else{a=a.elements||a;return s.create(this.anchor.reflectionIn([a[0],a[1],a[2]||0]),this.direction)}},setVectors:function(a,d){a=n.create(a);d=n.create(d);a.elements.length==2&&a.elements.push(0);d.elements.length==2&&d.elements.push(0);if(a.elements.length>3||d.elements.length>
3)return null;var f=d.modulus();if(f===0)return null;this.anchor=a;this.direction=n.create([d.elements[0]/f,d.elements[1]/f,d.elements[2]/f]);return this}};s.create=function(a,d){var f=new s;return f.setVectors(a,d)};l=s.create;s.X=s.create(n.Zero(3),n.i);s.Y=s.create(n.Zero(3),n.j);s.Z=s.create(n.Zero(3),n.k);y.prototype={eql:function(a){return this.contains(a.anchor)&&this.isParallelTo(a)},dup:function(){return y.create(this.anchor,this.normal)},translate:function(a){a=a.elements||a;return y.create([this.anchor.elements[0]+
a[0],this.anchor.elements[1]+a[1],this.anchor.elements[2]+(a[2]||0)],this.normal)},isParallelTo:function(a){if(a.normal){a=this.normal.angleFrom(a.normal);return Math.abs(a)<=z.precision||Math.abs(Math.PI-a)<=z.precision}else if(a.direction)return this.normal.isPerpendicularTo(a.direction);return null},isPerpendicularTo:function(a){a=this.normal.angleFrom(a.normal);return Math.abs(Math.PI/2-a)<=z.precision},distanceFrom:function(a){if(this.intersects(a)||this.contains(a))return 0;if(a.anchor){var d=
this.anchor.elements,f=a.anchor.elements;a=this.normal.elements;return Math.abs((d[0]-f[0])*a[0]+(d[1]-f[1])*a[1]+(d[2]-f[2])*a[2])}else{f=a.elements||a;d=this.anchor.elements;a=this.normal.elements;return Math.abs((d[0]-f[0])*a[0]+(d[1]-f[1])*a[1]+(d[2]-(f[2]||0))*a[2])}},contains:function(a){if(a.normal)return null;if(a.direction)return this.contains(a.anchor)&&this.contains(a.anchor.add(a.direction));else{a=a.elements||a;var d=this.anchor.elements,f=this.normal.elements;a=Math.abs(f[0]*(d[0]-a[0])+
f[1]*(d[1]-a[1])+f[2]*(d[2]-(a[2]||0)));return a<=z.precision}},intersects:function(a){if(typeof a.direction=="undefined"&&typeof a.normal=="undefined")return null;return!this.isParallelTo(a)},intersectionWith:function(a){if(!this.intersects(a))return null;if(a.direction){var d=a.anchor.elements,f=a.direction.elements;a=this.anchor.elements;var h=this.normal.elements;a=(h[0]*(a[0]-d[0])+h[1]*(a[1]-d[1])+h[2]*(a[2]-d[2]))/(h[0]*f[0]+h[1]*f[1]+h[2]*f[2]);return n.create([d[0]+f[0]*a,d[1]+f[1]*a,d[2]+
f[2]*a])}else if(a.normal){f=this.normal.cross(a.normal).toUnitVector();h=this.normal.elements;d=this.anchor.elements;var c=a.normal.elements,b=a.anchor.elements,e=q.Zero(2,2);for(a=0;e.isSingular();){a++;e=q.create([[h[a%3],h[(a+1)%3]],[c[a%3],c[(a+1)%3]]])}e=e.inverse().elements;d=h[0]*d[0]+h[1]*d[1]+h[2]*d[2];h=c[0]*b[0]+c[1]*b[1]+c[2]*b[2];d=[e[0][0]*d+e[0][1]*h,e[1][0]*d+e[1][1]*h];h=[];for(c=1;c<=3;c++)h.push(a==c?0:d[(c+(5-a)%3)%3]);return s.create(h,f)}},pointClosestTo:function(a){a=a.elements||
a;var d=this.anchor.elements,f=this.normal.elements;d=(d[0]-a[0])*f[0]+(d[1]-a[1])*f[1]+(d[2]-(a[2]||0))*f[2];return n.create([a[0]+f[0]*d,a[1]+f[1]*d,(a[2]||0)+f[2]*d])},rotate:function(a,d){var f=a.determinant?a.elements:q.Rotation(a,d.direction).elements,h=d.pointClosestTo(this.anchor).elements,c=this.anchor.elements,b=this.normal.elements,e=h[0],g=h[1];h=h[2];var i=c[0],k=c[1];c=c[2];i=i-e;k=k-g;c=c-h;return y.create([e+f[0][0]*i+f[0][1]*k+f[0][2]*c,g+f[1][0]*i+f[1][1]*k+f[1][2]*c,h+f[2][0]*i+
f[2][1]*k+f[2][2]*c],[f[0][0]*b[0]+f[0][1]*b[1]+f[0][2]*b[2],f[1][0]*b[0]+f[1][1]*b[1]+f[1][2]*b[2],f[2][0]*b[0]+f[2][1]*b[1]+f[2][2]*b[2]])},reflectionIn:function(a){if(a.normal){var d=this.anchor.elements,f=this.normal.elements,h=d[0],c=d[1];d=d[2];var b=f[0],e=f[1],g=f[2];f=this.anchor.reflectionIn(a).elements;h=h+b;c=c+e;d=d+g;a=a.pointClosestTo([h,c,d]).elements;a=[a[0]+(a[0]-h)-f[0],a[1]+(a[1]-c)-f[1],a[2]+(a[2]-d)-f[2]];return y.create(f,a)}else if(a.direction)return this.rotate(Math.PI,a);
else{a=a.elements||a;return y.create(this.anchor.reflectionIn([a[0],a[1],a[2]||0]),this.normal)}},setVectors:function(a,d,f){a=n.create(a);a=a.to3D();if(a===null)return null;d=n.create(d);d=d.to3D();if(d===null)return null;if(typeof f=="undefined")f=null;else{f=n.create(f);f=f.to3D();if(f===null)return null}var h=a.elements[0],c=a.elements[1],b=a.elements[2],e=d.elements[0],g=d.elements[1],i=d.elements[2];if(f!==null){d=f.elements[0];var k=f.elements[1];f=f.elements[2];c=n.create([(g-c)*(f-b)-(i-
b)*(k-c),(i-b)*(d-h)-(e-h)*(f-b),(e-h)*(k-c)-(g-c)*(d-h)]);h=c.modulus();if(h===0)return null;c=n.create([c.elements[0]/h,c.elements[1]/h,c.elements[2]/h])}else{h=Math.sqrt(e*e+g*g+i*i);if(h===0)return null;c=n.create([d.elements[0]/h,d.elements[1]/h,d.elements[2]/h])}this.anchor=a;this.normal=c;return this}};y.create=function(a,d,f){var h=new y;return h.setVectors(a,d,f)};l=y.create;y.XY=y.create(n.Zero(3),n.k);y.YZ=y.create(n.Zero(3),n.i);y.ZX=y.create(n.Zero(3),n.j);y.YX=y.XY;y.ZY=y.YZ;y.XZ=y.ZX;
y.fromPoints=function(a){var d=a.length,f=[],h,c,b,e,g,i,k=n.Zero(3);for(h=0;h<d;h++){c=n.create(a[h]).to3D();if(c===null)return null;f.push(c);c=f.length;if(c>2){b=f[c-1].elements;e=f[c-2].elements;g=f[c-3].elements;b=n.create([(b[1]-e[1])*(g[2]-e[2])-(b[2]-e[2])*(g[1]-e[1]),(b[2]-e[2])*(g[0]-e[0])-(b[0]-e[0])*(g[2]-e[2]),(b[0]-e[0])*(g[1]-e[1])-(b[1]-e[1])*(g[0]-e[0])]).toUnitVector();if(c>3){i=b.angleFrom(i);if(i!==null)if(!(Math.abs(i)<=z.precision||Math.abs(i-Math.PI)<=z.precision))return null}k=
k.add(b);i=b}}b=f[1].elements;e=f[0].elements;g=f[c-1].elements;a=f[c-2].elements;k=k.add(n.create([(b[1]-e[1])*(g[2]-e[2])-(b[2]-e[2])*(g[1]-e[1]),(b[2]-e[2])*(g[0]-e[0])-(b[0]-e[0])*(g[2]-e[2]),(b[0]-e[0])*(g[1]-e[1])-(b[1]-e[1])*(g[0]-e[0])]).toUnitVector()).add(n.create([(e[1]-g[1])*(a[2]-g[2])-(e[2]-g[2])*(a[1]-g[1]),(e[2]-g[2])*(a[0]-g[0])-(e[0]-g[0])*(a[2]-g[2]),(e[0]-g[0])*(a[1]-g[1])-(e[1]-g[1])*(a[0]-g[0])]).toUnitVector());return y.create(f[0],k)};j.linalg={};j.linalg.Vector=function(){return n.create.apply(null,
arguments)};j.linalg.Vector.create=n.create;j.linalg.Vector.i=n.i;j.linalg.Vector.j=n.j;j.linalg.Vector.k=n.k;j.linalg.Vector.Random=n.Random;j.linalg.Vector.Zero=n.Zero;j.linalg.Matrix=function(){return q.create.apply(null,arguments)};j.linalg.Matrix.create=q.create;j.linalg.Matrix.I=q.I;j.linalg.Matrix.Random=q.Random;j.linalg.Matrix.Rotation=q.Rotation;j.linalg.Matrix.RotationX=q.RotationX;j.linalg.Matrix.RotationY=q.RotationY;j.linalg.Matrix.RotationZ=q.RotationZ;j.linalg.Matrix.Zero=q.Zero;j.linalg.Line=
function(){return s.create.apply(null,arguments)};j.linalg.Line.create=s.create;j.linalg.Line.X=s.X;j.linalg.Line.Y=s.Y;j.linalg.Line.Z=s.Z;j.math={isnamespace_:true};if(!("toDegrees"in Number.prototype))Number.prototype.toDegrees=function(){return this*180/Math.PI};if(!("toRadians"in Number.prototype))Number.prototype.toRadians=function(){return this*Math.PI/180};j.math.normalizeAngle=function(a){a%=2*Math.PI;return a>=0?a:a+2*Math.PI};j.math.normalizeLat=function(a){return Math.max(-90,Math.min(90,
a))};j.math.normalizeLng=function(a){if(a%360==180)return 180;a%=360;return a<-180?a+360:a>180?a-360:a};j.math.reverseAngle=function(a){return j.math.normalizeAngle(a+Math.PI)};j.math.wrapValue=function(a,d,f){if(!d||!j.util.isArray(d)||d.length!=2)throw new TypeError("The range parameter must be an array of 2 numbers.");if(a===d[0])return d[0];a-=d[0];a%=d[1]-d[0];if(a<0)a+=d[1]-d[0];a+=d[0];return a===d[0]?f?d[0]:d[1]:a};j.math.constrainValue=function(a,d){if(!d||!j.util.isArray(d)||d.length!=2)throw new TypeError("The range parameter must be an array of 2 numbers.");
return Math.max(d[0],Math.min(d[1],a))};j.math.EARTH_RADIUS=6378135;j.math.EARTH_RADIUS_CURVATURE_AVG=6372795;j.math.distance=function(a,d){return j.math.EARTH_RADIUS*j.math.angularDistance(a,d)};j.math.angularDistance=function(a,d){var f=a.lat().toRadians(),h=d.lat().toRadians(),c=(d.lat()-a.lat()).toRadians(),b=(d.lng()-a.lng()).toRadians();f=Math.pow(Math.sin(c/2),2)+Math.cos(f)*Math.cos(h)*Math.pow(Math.sin(b/2),2);return 2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f))};j.math.heading=function(a,d){var f=
a.lat().toRadians(),h=d.lat().toRadians(),c=Math.cos(h),b=(d.lng()-a.lng()).toRadians();return j.math.normalizeAngle(Math.atan2(Math.sin(b)*c,Math.cos(f)*Math.sin(h)-Math.sin(f)*c*Math.cos(b))).toDegrees()};j.math.bearing=j.math.heading;j.math.midpoint=function(a,d,f){if(j.util.isUndefined(f)||f===null)f=0.5;if(a.equals(d))return new j.Point(a);var h=a.lat().toRadians(),c=d.lat().toRadians(),b=a.lng().toRadians(),e=d.lng().toRadians(),g=Math.cos(h),i=Math.cos(c);d=j.math.angularDistance(a,d);var k=
Math.sin(d);a=Math.sin((1-f)*d)/k;d=Math.sin(f*d)/k;f=a*g*Math.cos(b)+d*i*Math.cos(e);b=a*g*Math.sin(b)+d*i*Math.sin(e);h=a*Math.sin(h)+d*Math.sin(c);return new j.Point(Math.atan2(h,Math.sqrt(Math.pow(f,2)+Math.pow(b,2))).toDegrees(),Math.atan2(b,f).toDegrees())};j.math.destination=function(a,d){if(!("heading"in d&&"distance"in d))throw new TypeError("destination() requres both heading and distance options.");var f=a.lat().toRadians(),h=Math.sin(f),c=d.distance/j.math.EARTH_RADIUS,b=d.heading.toRadians(),
e=Math.sin(c);c=Math.cos(c);f=Math.asin(h*c+Math.cos(f)*e*Math.cos(b));return new j.Point(f.toDegrees(),Math.atan2(Math.sin(b)*e*Math.cos(f),c-h*Math.sin(f)).toDegrees()+a.lng())};j.Point=function(){var a=null;if(arguments.length==1){var d=arguments[0];if(d.constructor===j.Point){this.lat_=d.lat();this.lng_=d.lng();this.altitude_=d.altitude();this.altitudeMode_=d.altitudeMode()}else if(j.util.isArray(d))a=d;else if(C(d)){var f=d.getType();if(f=="KmlPoint"||f=="KmlLookAt"){this.lat_=d.getLatitude();
this.lng_=d.getLongitude();this.altitude_=d.getAltitude();this.altitudeMode_=d.getAltitudeMode()}else if(f=="KmlCoord"||f=="KmlLocation"){this.lat_=d.getLatitude();this.lng_=d.getLongitude();this.altitude_=d.getAltitude()}else throw new TypeError("Could not create a point from the given Earth object");}else if(window.google&&window.google.maps&&window.google.maps.LatLng&&d.constructor===window.google.maps.LatLng){this.lat_=d.lat();this.lng_=d.lng()}else throw new TypeError("Could not create a point from the given arguments");
}else a=arguments;if(a){for(d=0;d<a.length;d++)if(typeof a[d]!="number")throw new TypeError("Coordinates must be numerical");this.lat_=a[0];this.lng_=a[1];if(a.length>=3){this.altitude_=a[2];if(a.length>=4)this.altitudeMode_=a[3]}}this.lat_=j.math.normalizeLat(this.lat_);this.lng_=j.math.normalizeLng(this.lng_)};j.Point.prototype.lat=function(){return this.lat_};j.Point.prototype.lat_=0;j.Point.prototype.lng=function(){return this.lng_};j.Point.prototype.lng_=0;j.Point.prototype.altitude=function(){return this.altitude_};
j.Point.prototype.altitude_=0;j.Point.prototype.altitudeMode=function(){return this.altitudeMode_};j.Point.prototype.altitudeMode_=j.ALTITUDE_RELATIVE_TO_GROUND;j.Point.prototype.toString=function(){return"("+this.lat().toString()+", "+this.lng().toString()+", "+this.altitude().toString()+")"};j.Point.prototype.flatten=function(){return new j.Point(this.lat(),this.lng())};j.Point.prototype.is3D=function(){return this.altitude_!==0};j.Point.prototype.equals=function(a){return this.lat()==a.lat()&&
this.lng()==a.lng()&&this.altitude()==a.altitude()&&this.altitudeMode()==a.altitudeMode()};j.Point.prototype.angularDistance=function(a){return j.math.angularDistance(this,a)};j.Point.prototype.distance=function(a){return j.math.distance(this,a)};j.Point.prototype.heading=function(a){return j.math.heading(this,a)};j.Point.prototype.midpoint=function(a,d){return j.math.midpoint(this,a,d)};j.Point.prototype.destination=function(a){return j.math.destination(this,a)};j.Point.prototype.toCartesian=function(){var a=
Math.sin(this.lng().toRadians()),d=Math.cos(this.lng().toRadians()),f=Math.sin(this.lat().toRadians()),h=Math.cos(this.lat().toRadians()),c=j.math.EARTH_RADIUS+this.altitude();return new j.linalg.Vector([c*d*h,c*f,c*-a*h])};j.Point.fromCartesian=function(a){var d=a.distanceFrom(j.linalg.Vector.Zero(3));a=a.toUnitVector();d=d-j.math.EARTH_RADIUS;var f=Math.asin(a.e(2)).toDegrees();if(f>90)f-=180;var h=0;if(Math.abs(f)<90)h=-Math.atan2(a.e(3),a.e(1)).toDegrees();return new j.Point(f,h,d)};j.Bounds=
function(){if(arguments.length==1)if(arguments[0].constructor===j.Bounds){var a=arguments[0];this.sw_=new j.Point(a.southWestBottom());this.ne_=new j.Point(a.northEastTop())}else this.sw_=this.ne_=new j.Point(arguments[0]);else if(arguments.length==2){a=new j.Point(arguments[0]);var d=new j.Point(arguments[1]);if(a||d){if(a)d||(d=a);else a=d;if(a.lat()>d.lat())throw new RangeError("Bounds southwest coordinate cannot be north of the northeast coordinate");if(a.altitude()>d.altitude())throw new RangeError("Bounds southwest coordinate cannot be north of the northeast coordinate");
this.sw_=a;this.ne_=d}}};j.Bounds.prototype.southWestBottom=function(){return this.sw_};j.Bounds.prototype.sw_=null;j.Bounds.prototype.south=function(){return!this.isEmpty()?this.sw_.lat():null};j.Bounds.prototype.west=function(){return!this.isEmpty()?this.sw_.lng():null};j.Bounds.prototype.bottom=function(){return!this.isEmpty()?this.sw_.altitude():null};j.Bounds.prototype.northEastTop=function(){return this.ne_};j.Bounds.prototype.ne_=null;j.Bounds.prototype.north=function(){return!this.isEmpty()?
this.ne_.lat():null};j.Bounds.prototype.east=function(){return!this.isEmpty()?this.ne_.lng():null};j.Bounds.prototype.top=function(){return!this.isEmpty()?this.ne_.altitude():null};j.Bounds.prototype.crossesAntimeridian=function(){return!this.isEmpty()&&this.sw_.lng()>this.ne_.lng()};j.Bounds.prototype.is3D=function(){return!this.isEmpty()&&(this.sw_.is3D()||this.ne_.is3D())};j.Bounds.prototype.containsPoint=function(a){a=new j.Point(a);if(this.isEmpty())return false;if(!(this.south()<=a.lat()&&a.lat()<=
this.north()))return false;if(this.is3D()&&!(this.bottom()<=a.altitude()&&a.altitude()<=this.top()))return false;return this.containsLng_(a.lng())};j.Bounds.prototype.containsLng_=function(a){return this.crossesAntimeridian()?a<=this.east()||a>=this.west():this.west()<=a&&a<=this.east()};j.Bounds.prototype.extend=function(a){a=new j.Point(a);if(!this.containsPoint(a))if(this.isEmpty())this.sw_=this.ne_=a;else{var d=this.bottom(),f=this.top();if(this.is3D()){d=Math.min(d,a.altitude());f=Math.max(f,
a.altitude())}var h=Math.min(this.south(),a.lat()),c=Math.max(this.north(),a.lat()),b=this.west(),e=this.east();if(!this.containsLng_(a.lng())){var g=E(b,a.lng()),i=E(a.lng(),e);if(g<=i)e=a.lng();else b=a.lng()}this.sw_=new j.Point(h,b,d);this.ne_=new j.Point(c,e,f)}};j.Bounds.prototype.span=function(){if(this.isEmpty())return{lat:0,lng:0,altitude:0};return{lat:this.ne_.lat()-this.sw_.lat(),lng:E(this.sw_.lng(),this.ne_.lng()),altitude:this.is3D()?this.ne_.altitude()-this.sw_.altitude():null}};j.Bounds.prototype.isEmpty=
function(){return this.sw_===null&&this.sw_===null};j.Bounds.prototype.center=function(){if(this.isEmpty())return null;return new j.Point((this.sw_.lat()+this.ne_.lat())/2,this.crossesAntimeridian()?j.math.normalizeLng(this.sw_.lng()+E(this.sw_.lng(),this.ne_.lng())/2):(this.sw_.lng()+this.ne_.lng())/2,(this.sw_.altitude()+this.ne_.altitude())/2)};j.Bounds.prototype.getCenter=j.Bounds.prototype.center;j.Bounds.prototype.isFullLat=function(){return!this.isEmpty()&&this.south()==-90&&this.north()==
90};j.Bounds.prototype.isFullLng=function(){return!this.isEmpty()&&this.west()==-180&&this.east()==180};j.Path=function(){this.coords_=[];var a=null,d,f;if(arguments.length==1){var h=arguments[0];if(h.constructor===j.Path)for(d=0;d<h.numCoords();d++)this.coords_.push(new j.Point(h.coord(d)));else if(j.util.isArray(h))a=h;else if(C(h)){d=h.getType();if(d=="KmlLineString"||d=="KmlLinearRing"){f=h.getCoordinates().getLength();for(d=0;d<f;d++)this.coords_.push(new j.Point(h.getCoordinates().get(d)))}else throw new TypeError("Could not create a path from the given arguments");
}else if("getVertex"in h&&"getVertexCount"in h){f=h.getVertexCount();for(d=0;d<f;d++)this.coords_.push(new j.Point(h.getVertex(d)))}else throw new TypeError("Could not create a path from the given arguments");}else a=arguments;if(a)for(d=0;d<a.length;d++)this.coords_.push(new j.Point(a[d]))};j.Path.prototype.coords_=null;j.Path.prototype.toString=function(){return"["+this.coords_.map(function(a){return a.toString()}).join(", ")+"]"};j.Path.prototype.equals=function(a){for(var d=0;d<a.numCoords();d++)if(!this.coord(d).equals(a.coord(d)))return false;
return true};j.Path.prototype.numCoords=function(){return this.coords_.length};j.Path.prototype.coord=function(a){return this.coords_[a]};j.Path.prototype.prepend=function(a){this.coords_.unshift(new j.Point(a))};j.Path.prototype.append=function(a){this.coords_.push(new j.Point(a))};j.Path.prototype.insert=function(a,d){this.coords_.splice(a,0,new j.Point(d))};j.Path.prototype.remove=function(a){this.coords_.splice(a,1)};j.Path.prototype.subPath=function(a,d){return this.coords_.slice(a,d)};j.Path.prototype.reverse=
function(){this.coords_.reverse()};j.Path.prototype.distance=function(){for(var a=0,d=0;d<this.coords_.length-1;d++)a+=this.coords_[d].distance(this.coords_[d+1]);return a};j.Path.prototype.containsPoint=function(a){var d=false,f=a.lat();a=a.lng();for(var h=0;h<this.coords_.length;h++){var c=(h+1)%this.coords_.length;if((this.coords_[h].lat()<f&&this.coords_[c].lat()>=f||this.coords_[c].lat()<f&&this.coords_[h].lat()>=f)&&this.coords_[h].lng()+(f-this.coords_[h].lat())/(this.coords_[c].lat()-this.coords_[h].lat())*
(this.coords_[c].lng()-this.coords_[h].lng())<a)d=!d}return d};j.Path.prototype.bounds=function(){if(!this.numCoords())return new j.Bounds;for(var a=new j.Bounds(this.coord(0)),d=this.numCoords(),f=1;f<d;f++)a.extend(this.coord(f));return a};j.Path.prototype.signedArea_=function(){var a=0,d=this.bounds(),f=d.west();d=d.south();for(var h=this.numCoords(),c=0;c<h;c++){var b=(c+1)%h,e=this.coord(c).distance(new j.Point(this.coord(c).lat(),f)),g=this.coord(b).distance(new j.Point(this.coord(b).lat(),
f)),i=this.coord(c).distance(new j.Point(d,this.coord(c).lng()));b=this.coord(b).distance(new j.Point(d,this.coord(b).lng()));a+=e*b-g*i}return a*0.5};j.Path.prototype.area=function(){return Math.abs(this.signedArea_())};j.Path.prototype.isCounterClockwise_=function(){return Boolean(this.signedArea_()>=0)};j.Polygon=function(){this.outerBoundary_=new j.Path;this.innerBoundaries_=[];var a;if(arguments.length!==0)if(arguments.length==1){var d=arguments[0];if(d.constructor===j.Polygon){this.outerBoundary_=
new j.Path(d.outerBoundary());for(a=0;a<d.innerBoundaries().length;a++)this.innerBoundaries_.push(new j.Path(d.innerBoundaries()[a]))}else if(C(d)){a=d.getType();if(a=="KmlLineString"||a=="KmlLinearRing")this.outerBoundary_=new j.Path(d);else if(a=="KmlPolygon"){this.outerBoundary_=new j.Path(d.getOuterBoundary());d=d.getInnerBoundaries().getChildNodes();var f=d.getLength();for(a=0;a<f;a++)this.innerBoundaries_.push(new j.Path(d.item(a)))}else throw new TypeError("Could not create a polygon from the given arguments");
}else this.outerBoundary_=new j.Path(arguments[0])}else if(arguments[0].length&&typeof arguments[0][0]=="number")this.outerBoundary_=new j.Path(arguments);else if(arguments[1]){this.outerBoundary_=new j.Path(arguments[0]);if(!j.util.isArray(arguments[1]))throw new TypeError("Second argument to geo.Polygon constructor must be an array of paths.");for(a=0;a<arguments[1].length;a++)this.innerBoundaries_.push(new j.Path(arguments[1][a]))}else throw new TypeError("Cannot create a path from the given arguments.");
};j.Polygon.prototype.outerBoundary_=null;j.Polygon.prototype.innerBoundaries_=null;j.Polygon.prototype.toString=function(){return"Polygon: "+this.outerBoundary().toString()+(this.innerBoundaries().length?", ("+this.innerBoundaries().length+" inner boundaries)":"")};j.Polygon.prototype.outerBoundary=function(){return this.outerBoundary_};j.Polygon.prototype.innerBoundaries=function(){return this.innerBoundaries_};j.Polygon.prototype.containsPoint=function(a){if(!this.outerBoundary_.containsPoint(a))return false;
for(var d=0;d<this.innerBoundaries_.length;d++)if(this.innerBoundaries_[d].containsPoint(a))return false;return true};j.Polygon.prototype.bounds=function(){return this.outerBoundary_.bounds()};j.Polygon.prototype.area=function(){for(var a=this.outerBoundary_.area(),d=0;d<this.innerBoundaries_.length;d++)a-=this.innerBoundaries_[d].area();return a};j.Polygon.prototype.isCounterClockwise=function(){return this.outerBoundary_.isCounterClockwise_()};j.Polygon.prototype.makeCounterClockwise=function(){this.isCounterClockwise()&&
this.outerBoundary_.reverse()};j.util={isnamespace_:true};j.util.isUndefined=function(a){return typeof a=="undefined"};j.util.isArray=function(a){return a!==null&&typeof a=="object"&&"splice"in a&&"join"in a};j.util.isFunction=function(a){return a!==null&&typeof a=="function"&&"call"in a&&"apply"in a};j.util.isObjectLiteral=function(a){return a!==null&&typeof a=="object"&&a.constructor===Object&&!C(a)};window.geo=j})();
(function(){function n(c,b,e){var g={};c=c||{};e=e||{};for(var i in c){if(!b&&!(i in e)){c=[];for(var k in e)c.push(k);throw Error("Unexpected parameter '"+i+"'. Allowed parameters are: "+c.join(", ")+".");}g[i]=c[i]}for(i in e)if(!(i in g)){if(e[i]===undefined)throw Error("Required parameter '"+i+"' was not passed.");if(e[i]!=null&&e[i]!=Infinity)g[i]=e[i]}return g}function q(){var c=[],b=null;if(geo.util.isArray(arguments[0])){c=arguments[0];b=arguments[1]}else b=arguments[0];b.isclass_=true;for(var e=
0;e<c.length;e++)for(var g in c[e].prototype)b.prototype[g]=c[e].prototype[g];return b}function s(c){if(c.apiInterface&&!geo.util.isArray(c.apiInterface))c.apiInterface=[c.apiInterface];for(var b=c.base;b;){if("propertySpec"in b.builderParams){if(!("propertySpec"in c))c.propertySpec=[];for(var e in b.builderParams.propertySpec)e in c.propertySpec||(c.propertySpec[e]=b.builderParams.propertySpec[e])}if(!c.apiInterface)c.apiInterface=b.builderParams.apiInterface;if(!c.apiFactoryFn)c.apiFactoryFn=b.builderParams.apiFactoryFn;
b=b.builderParams.base}var g={id:""};for(e in g)e in c.propertySpec||(c.propertySpec[e]=g[e]);e=function(){var i={},k;if(arguments.length===0)throw new TypeError("Cannot create object without any arguments!");else if(arguments.length==1){for(k=0;k<c.apiInterface.length;k++)if(l.isInstanceOfEarthInterface(arguments[0],c.apiInterface[k]))return arguments[0];k=arguments[0];if(geo.util.isObjectLiteral(k))i=k;else if("defaultProperty"in c)i[c.defaultProperty]=k;else throw new TypeError("Expected options object");
}else if(arguments.length==2)if("defaultProperty"in c){i=arguments[1];i[c.defaultProperty]=arguments[0]}else throw Error("No default property for the DOM builder");i=n(i,false,c.propertySpec);k=this.util.callMethod(this.pluginInstance,c.apiFactoryFn,i.id);geo.util.isUndefined(c.constructor)||c.constructor.call(this,k,i);for(b=c.base;b;){"constructor"in b.builderParams&&b.builderParams.constructor.call(this,k,i);b=b.builderParams.base}for(var m in c.propertySpec)c.propertySpec[m]===Infinity&&m in i&&
this.util.callMethod(k,"set"+m.charAt(0).toUpperCase()+m.substr(1),i[m]);return k};e.builderParams=c;return e}function y(c,b){var e=c.util.getJsDataValue(b,"_GEarthExtensions_dragData")||{};f={placemark:b,startAltitude:b.getGeometry().getAltitude(),draggableOptions:e.draggableOptions,dragged:false}}function E(c){return function(b){if(f){b.preventDefault();if(b.getDidHitGlobe()){if(!f.dragged){f.dragged=true;if(f.draggableOptions.draggingStyle){f.oldStyle=f.placemark.getStyleSelector();f.placemark.setStyleSelector(c.dom.buildStyle(f.draggableOptions.draggingStyle))}if(f.draggableOptions.bounce){c.fx.cancel(f.placemark);
c.fx.bounce(f.placemark,{phase:1})}if(f.draggableOptions.targetScreenOverlay){var e=c.dom.buildScreenOverlay(f.draggableOptions.targetScreenOverlay);c.pluginInstance.getFeatures().appendChild(e);f.activeTargetScreenOverlay=e}}f.activeTargetScreenOverlay&&c.dom.setVec2(f.activeTargetScreenOverlay.getOverlayXY(),{left:b.getClientX(),top:b.getClientY()});e=f.placemark.getGeometry();e.setLatitude(b.getLatitude());e.setLongitude(b.getLongitude());f.placemark.setVisibility(true);f.draggableOptions.dragCallback&&
f.draggableOptions.dragCallback.call(f.placemark)}}}}function C(c,b){if(f){if(f.dragged){if(f.oldStyle){f.placemark.setStyleSelector(f.oldStyle);delete f.oldStyle}if(f.activeTargetScreenOverlay){c.pluginInstance.getFeatures().removeChild(f.activeTargetScreenOverlay);delete f.activeTargetScreenOverlay}if(f.draggableOptions.bounce){c.fx.cancel(f.placemark);c.fx.bounce(f.placemark,{startAltitude:f.startAltitude,phase:2,repeat:1,dampen:0.3})}}var e=f;f=null;e.dragged&&e.draggableOptions.dropCallback&&
!b&&e.draggableOptions.dropCallback.call(e.placemark)}}function j(c,b){return c.getLatitude()==b.getLatitude()&&c.getLongitude()==b.getLongitude()&&c.getAltitude()==b.getAltitude()}function z(c){for(var b in h)if(h[b].object.equals(c))return b;return null}var l=function(c){function b(i){return function(){return i.apply(g,arguments)}}function e(i){for(var k in i){var m=i[k];if(geo.util.isFunction(m))if(m.isclass_)m.extInstance_=g;else i[k]=b(m);if(m!==null&&typeof m=="object"&&"isnamespace_"in m&&
m.isnamespace_){var o={};for(var t in m)o[t]=m[t];e(o);i[k]=o}}}var g=this;this.pluginInstance=c;e(this)};l.isInstanceOfEarthInterface=function(c,b){return c!==null&&(typeof c=="object"||typeof c=="function")&&"getType"in c&&c.getType()==b};l.prototype.dom={isnamespace_:true};l.prototype.dom.buildFeature_=s({propertySpec:{name:Infinity,visibility:Infinity,description:Infinity,snippet:Infinity,region:null},constructor:function(c,b){b.region&&c.setRegion(this.dom.buildRegion(b.region))}});l.prototype.dom.buildPlacemark=
s({apiInterface:"KmlPlacemark",base:l.prototype.dom.buildFeature_,apiFactoryFn:"createPlacemark",propertySpec:{point:null,lineString:null,linearRing:null,polygon:null,model:null,geometries:null,altitudeMode:null,stockIcon:null,icon:null,style:null,highlightStyle:null},constructor:function(c,b){var e=[];b.point&&e.push(this.dom.buildPoint(b.point));b.lineString&&e.push(this.dom.buildLineString(b.lineString));b.linearRing&&e.push(this.dom.buildLinearRing(b.linearRing));b.polygon&&e.push(this.dom.buildPolygon(b.polygon));
b.model&&e.push(this.dom.buildModel(b.model));b.multiGeometry&&e.push(this.dom.buildMultiGeometry(b.multiGeometry));if(b.geometries)e=e.concat(b.geometries);if(e.length>1)c.setGeometry(this.dom.buildMultiGeometry(e));else e.length==1&&c.setGeometry(e[0]);if(b.stockIcon){b.icon=b.icon||{};b.icon.stockIcon=b.stockIcon}if(b.icon){if(!b.style)b.style={};b.style.icon=b.icon}"altitudeMode"in b&&c.getGeometry().setAltitudeMode(b.altitudeMode);if(b.style)if(b.highlightStyle){e=this.pluginInstance.createStyleMap("");
typeof b.style=="string"?e.setNormalStyleUrl(b.style):e.setNormalStyle(this.dom.buildStyle(b.style));typeof b.highlightStyle=="string"?e.setHighlightStyleUrl(b.highlightStyle):e.setHighlightStyle(this.dom.buildStyle(b.highlightStyle));c.setStyleSelector(e)}else typeof b.style=="string"?c.setStyleUrl(b.style):c.setStyleSelector(this.dom.buildStyle(b.style))}});l.prototype.dom.buildPointPlacemark=s({base:l.prototype.dom.buildPlacemark,defaultProperty:"point"});l.prototype.dom.buildLineStringPlacemark=
s({base:l.prototype.dom.buildPlacemark,defaultProperty:"lineString"});l.prototype.dom.buildPolygonPlacemark=s({base:l.prototype.dom.buildPlacemark,defaultProperty:"polygon"});l.prototype.dom.buildNetworkLink=s({apiInterface:"KmlNetworkLink",base:l.prototype.dom.buildFeature_,apiFactoryFn:"createNetworkLink",defaultProperty:"link",propertySpec:{link:null,flyToView:Infinity,refreshVisibility:Infinity},constructor:function(c,b){b.link&&c.setLink(this.dom.buildLink(b.link))}});l.prototype.dom.buildContainer_=
s({base:l.prototype.dom.buildFeature_,propertySpec:{children:null},constructor:function(c,b){if(b.children)for(var e=0;e<b.children.length;e++)c.getFeatures().appendChild(b.children[e])}});l.prototype.dom.buildFolder=s({apiInterface:"KmlFolder",base:l.prototype.dom.buildContainer_,apiFactoryFn:"createFolder",defaultProperty:"children"});l.prototype.dom.buildDocument=s({apiInterface:"KmlDocument",base:l.prototype.dom.buildContainer_,apiFactoryFn:"createDocument",defaultProperty:"children"});l.prototype.dom.buildOverlay_=
s({base:l.prototype.dom.buildFeature_,propertySpec:{color:null,icon:null,drawOrder:Infinity},constructor:function(c,b){b.color&&c.getColor().set(this.util.parseColor(b.color));if(b.icon){var e=this.pluginInstance.createIcon("");c.setIcon(e);typeof b.icon=="string"&&e.setHref(b.icon)}}});l.prototype.dom.buildGroundOverlay=s({apiInterface:"KmlGroundOverlay",base:l.prototype.dom.buildOverlay_,apiFactoryFn:"createGroundOverlay",defaultProperty:"icon",propertySpec:{box:undefined,altitude:Infinity,altitudeMode:Infinity},
constructor:function(c,b){if(b.box){var e=this.pluginInstance.createLatLonBox("");e.setBox(b.box.north,b.box.south,b.box.east,b.box.west,b.box.rotation?b.box.rotation:0);c.setLatLonBox(e)}}});l.prototype.dom.buildScreenOverlay=s({apiInterface:"KmlScreenOverlay",base:l.prototype.dom.buildOverlay_,apiFactoryFn:"createScreenOverlay",defaultProperty:"icon",propertySpec:{screenXY:undefined,size:undefined,rotation:Infinity,overlayXY:{left:0,top:0},rotationXY:null},constructor:function(c,b){this.dom.setVec2(c.getScreenXY(),
b.overlayXY);this.dom.setVec2(c.getOverlayXY(),b.screenXY);this.dom.setVec2(c.getSize(),b.size);"rotationXY"in b&&this.dom.setVec2(c.getRotationXY(),b.rotationXY)}});for(var a=["Placemark","PointPlacemark","LineStringPlacemark","PolygonPlacemark","Folder","NetworkLink","GroundOverlay","ScreenOverlay","Style"],d=0;d<a.length;d++)l.prototype.dom["add"+a[d]]=function(c){return function(){var b=this.dom["build"+c].apply(null,arguments);this.pluginInstance.getFeatures().appendChild(b);return b}}(a[d]);
l.prototype.dom.buildExtrudableGeometry_=s({propertySpec:{altitudeMode:Infinity,extrude:Infinity,tessellate:Infinity}});l.prototype.dom.buildPoint=s({apiInterface:"KmlPoint",base:l.prototype.dom.buildExtrudableGeometry_,apiFactoryFn:"createPoint",defaultProperty:"point",propertySpec:{point:undefined},constructor:function(c,b){var e=new geo.Point(b.point);c.set(e.lat(),e.lng(),e.altitude(),"altitudeMode"in b?b.altitudeMode:e.altitudeMode(),false,false)}});l.prototype.dom.buildLineString=s({apiInterface:"KmlLineString",
base:l.prototype.dom.buildExtrudableGeometry_,apiFactoryFn:"createLineString",defaultProperty:"path",propertySpec:{path:undefined},constructor:function(c,b){for(var e=c.getCoordinates(),g=new geo.Path(b.path),i=g.numCoords(),k=0;k<i;k++)e.pushLatLngAlt(g.coord(k).lat(),g.coord(k).lng(),g.coord(k).altitude())}});l.prototype.dom.buildLinearRing=s({apiInterface:"KmlLinearRing",base:l.prototype.dom.buildLineString,apiFactoryFn:"createLinearRing",defaultProperty:"path",constructor:function(c,b){}});l.prototype.dom.buildPolygon=
s({apiInterface:"KmlPolygon",base:l.prototype.dom.buildExtrudableGeometry_,apiFactoryFn:"createPolygon",defaultProperty:"polygon",propertySpec:{polygon:undefined},constructor:function(c,b){var e=new geo.Polygon(b.polygon);c.setOuterBoundary(this.dom.buildLinearRing(e.outerBoundary()));if(e.innerBoundaries().length){e=e.innerBoundaries();for(var g=0;g<e.length;g++)c.getInnerBoundaries().appendChild(this.dom.buildLinearRing(e[g]))}}});l.prototype.dom.buildModel=s({apiInterface:"KmlModel",apiFactoryFn:"createModel",
defaultProperty:"link",propertySpec:{altitudeMode:Infinity,link:null,location:null,scale:null,orientation:null},constructor:function(c,b){b.link&&c.setLink(this.dom.buildLink(b.link));if(b.location){var e=new geo.Point(b.location),g=this.pluginInstance.createLocation("");g.setLatLngAlt(e.lat(),e.lng(),e.altitude());c.setLocation(g);c.setAltitudeMode(e.altitudeMode())}if(b.scale){e=this.pluginInstance.createScale("");if(typeof b.scale=="number")e.set(b.scale,b.scale,b.scale);else geo.util.isArray(b.scale)&&
e.set(b.scale[0],b.scale[1],b.scale[2]);c.setScale(e)}if(b.orientation){e=this.pluginInstance.createOrientation("");"heading"in b.orientation&&"tilt"in b.orientation&&"roll"in b.orientation&&e.set(b.orientation.heading,b.orientation.tilt,b.orientation.roll);c.setOrientation(e)}}});l.prototype.dom.buildMultiGeometry=s({apiInterface:"KmlMultiGeometry",apiFactoryFn:"createMultiGeometry",defaultProperty:"geometries",propertySpec:{geometries:null},constructor:function(c,b){var e=c.getGeometries();if(geo.util.isArray(b.geometries))for(var g=
0;g<b.geometries.length;g++)e.appendChild(b.geometries[g])}});l.prototype.dom.buildLink=s({apiInterface:"KmlLink",apiFactoryFn:"createLink",defaultProperty:"href",propertySpec:{href:Infinity,refreshMode:Infinity,refreshInterval:Infinity,viewRefreshMode:Infinity,viewBoundScale:Infinity}});l.prototype.dom.buildRegion=s({apiInterface:"KmlRegion",apiFactoryFn:"createRegion",propertySpec:{box:undefined,lod:null},constructor:function(c,b){var e=this.pluginInstance.createLatLonAltBox("");if(b.box.center&&
b.box.span){if(!geo.util.isArray(b.box.span)&&typeof b.box.span==="number")b.box.span=[b.box.span,b.box.span];var g=new geo.Point(b.box.center);b.box.north=g.lat()+b.box.span[0]/2;b.box.south=g.lat()-b.box.span[0]/2;b.box.east=g.lng()+b.box.span[1]/2;b.box.west=g.lng()-b.box.span[1]/2}e.setAltBox(b.box.north,b.box.south,b.box.east,b.box.west,b.box.rotation||0,b.box.minAltitude||0,b.box.maxAltitude||0,b.box.altitudeMode||this.pluginInstance.ALTITUDE_CLAMP_TO_GROUND);g=this.pluginInstance.createLod("");
g.set(-1,-1,0,0);if(b.lod&&geo.util.isArray(b.lod))if(b.lod.length==2)g.set(b.lod[0],b.lod[1],0,0);else b.lod.length==4&&g.set(b.lod[0],b.lod[3],b.lod[1],b.lod[2]);c.setLatLonAltBox(e);c.setLod(g)}});l.prototype.dom.buildStyle=s({apiInterface:["KmlStyle","KmlStyleMap"],apiFactoryFn:"createStyle",propertySpec:{icon:null,label:null,line:null,poly:null,balloon:null},constructor:function(c,b){var e=function(o){return(o.length<2?"0":"")+o},g=this,i=function(o,t){o=o?g.util.parseColor(o):"ffffffff";geo.util.isUndefined(t)||
(o=e(Math.floor(255*t).toString(16))+o.substring(2));return o};if(b.icon){var k=c.getIconStyle();if(typeof b.icon=="string")b.icon={href:b.icon};var m=this.pluginInstance.createIcon("");k.setIcon(m);if("href"in b.icon)m.setHref(b.icon.href);else if("stockIcon"in b.icon)m.setHref("http://maps.google.com/mapfiles/kml/"+b.icon.stockIcon+".png");else{m.setHref("http://maps.google.com/mapfiles/kml/paddle/wht-blank.png");k.getHotSpot().set(0.5,this.pluginInstance.UNITS_FRACTION,0,this.pluginInstance.UNITS_FRACTION)}"scale"in
b.icon&&k.setScale(b.icon.scale);"heading"in b.icon&&k.setHeading(b.icon.heading);if("color"in b.icon||"opacity"in b.icon){b.icon.color=i(b.icon.color,b.icon.opacity);k.getColor().set(b.icon.color)}if("opacity"in b.icon){if(!("color"in b.icon))b.icon.color="ffffffff";b.icon.color=e(b.icon.opacity.toString(16))+b.icon.color.substring(2)}"hotSpot"in b.icon&&this.dom.setVec2(k.getHotSpot(),b.icon.hotSpot)}if(b.label){k=c.getLabelStyle();if(typeof b.label=="string")b.label={color:b.label};"scale"in b.label&&
k.setScale(b.label.scale);if("color"in b.label||"opacity"in b.label){b.label.color=i(b.label.color,b.label.opacity);k.getColor().set(b.label.color)}}if(b.line){k=c.getLineStyle();if(typeof b.line=="string")b.line={color:b.line};"width"in b.line&&k.setWidth(b.line.width);if("color"in b.line||"opacity"in b.line){b.line.color=i(b.line.color,b.line.opacity);k.getColor().set(b.line.color)}}if(b.poly){k=c.getPolyStyle();if(typeof b.poly=="string")b.poly={color:b.poly};"fill"in b.poly&&k.setFill(b.poly.fill);
"outline"in b.poly&&k.setOutline(b.poly.outline);if("color"in b.poly||"opacity"in b.poly){b.poly.color=i(b.poly.color,b.poly.opacity);k.getColor().set(b.poly.color)}}if(b.balloon){i=c.getBalloonStyle();if(typeof b.balloon=="string")b.balloon={bgColor:b.balloon};"bgColor"in b.balloon&&i.getBgColor().set(g.util.parseColor(b.balloon.bgColor));"textColor"in b.balloon&&i.getTextColor().set(g.util.parseColor(b.balloon.textColor));"text"in b.balloon&&i.setText(b.balloon.text)}}});l.prototype.dom.clearFeatures=
function(){for(var c=this.pluginInstance.getFeatures(),b;(b=c.getLastChild())!==null;)c.removeChild(b)};l.prototype.dom.walk=function(){var c;if(arguments.length==1)if(geo.util.isObjectLiteral(arguments[0]))c=arguments[0];else if(geo.util.isFunction(arguments[0]))c={visitCallback:arguments[0]};else throw new TypeError("walk requires a visit callback function or options literal as a first parameter");else throw Error("walk takes at most 1 arguments");c=n(c,false,{visitCallback:undefined,features:true,
geometries:false,rootObject:this.pluginInstance,rootContext:null});var b=function(e,g){var i={current:g,child:g,walkChildren:true},k=c.visitCallback.call(e,i);if(!k&&!geo.util.isUndefined(k))return false;if(!i.walkChildren)return true;k=null;if("getFeatures"in e){if(c.features)k=e.getFeatures()}else if("getGeometry"in e)c.geometries&&e.getGeometry()&&b(e.getGeometry(),i.child);else if("getGeometries"in e){if(c.geometries)k=e.getGeometries()}else if("getOuterBoundary"in e)if(c.geometries&&e.getOuterBoundary()){b(e.getOuterBoundary(),
i.child);k=e.getInnerBoundaries()}if(k&&k.hasChildNodes()){k=k.getChildNodes();for(var m=k.getLength(),o=0;o<m;o++){var t=k.item(o);if(!b(t,i.child))return false}}return true};c.rootObject&&b(c.rootObject,c.rootContext)};l.prototype.dom.getObjectById=function(c,b){b=n(b,false,{recursive:true,rootObject:this.pluginInstance});if("getId"in b.rootObject&&b.rootObject.getId()==c)return b.rootObject;var e=null;this.dom.walk({rootObject:b.rootObject,features:true,geometries:true,visitCallback:function(){if("getId"in
this&&this.getId()==c){e=this;return false}}});return e};l.prototype.dom.removeObject=function(c){if(c){var b=c.getParentNode();if(!b)throw Error("Cannot remove an object without a parent.");var e=null;if("getFeatures"in b)e=b.getFeatures();else if("getGeometries"in b)e=b.getGeometries();else if("getInnerBoundaries"in b)e=b.getInnerBoundaries();e.removeChild(c)}};l.prototype.dom.setVec2=function(c,b){if("getType"in b&&b.getType()=="KmlVec2")c.set(b.getX(),b.getXUnits(),b.getY(),b.getYUnits());else{b=
n(b,false,{left:null,top:null,right:null,bottom:null,width:null,height:null});if("width"in b)b.left=b.width;if("height"in b)b.bottom=b.height;var e=0,g=this.pluginInstance.UNITS_PIXELS,i=0,k=this.pluginInstance.UNITS_PIXELS;if("left"in b)if(typeof b.left=="number")e=b.left;else if(typeof b.left=="string"&&b.left.charAt(b.left.length-1)=="%"){e=parseFloat(b.left)/100;g=this.pluginInstance.UNITS_FRACTION}else throw new TypeError("left must be a number or string indicating a percentage");else if("right"in
b)if(typeof b.right=="number"){e=b.right;g=this.pluginInstance.UNITS_INSET_PIXELS}else if(typeof b.right=="string"&&b.right.charAt(b.right.length-1)=="%"){e=1-parseFloat(b.right)/100;g=this.pluginInstance.UNITS_FRACTION}else throw new TypeError("right must be a number or string indicating a percentage");if("bottom"in b)if(typeof b.bottom=="number")i=b.bottom;else if(typeof b.bottom=="string"&&b.bottom.charAt(b.bottom.length-1)=="%"){i=parseFloat(b.bottom)/100;k=this.pluginInstance.UNITS_FRACTION}else throw new TypeError("bottom must be a number or string indicating a percentage");
else if("top"in b)if(typeof b.top=="number"){i=b.top;k=this.pluginInstance.UNITS_INSET_PIXELS}else if(typeof b.top=="string"&&b.top.charAt(b.top.length-1)=="%"){i=1-parseFloat(b.top)/100;k=this.pluginInstance.UNITS_FRACTION}else throw new TypeError("top must be a number or string indicating a percentage");c.set(e,g,i,k)}};l.prototype.dom.computeBounds=function(c){var b=new geo.Bounds;this.dom.walk({rootObject:c,features:true,geometries:true,visitCallback:function(){if("getType"in this){var e=this.getType();
switch(e){case "KmlGroundOverlay":if(e=this.getLatLonBox()){var g=this.getAltitude();b.extend(new geo.Point(e.getNorth(),e.getEast(),g));b.extend(new geo.Point(e.getNorth(),e.getWest(),g));b.extend(new geo.Point(e.getSouth(),e.getEast(),g));b.extend(new geo.Point(e.getSouth(),e.getWest(),g))}break;case "KmlModel":b.extend(new geo.Point(this.getLocation()));break;case "KmlLinearRing":case "KmlLineString":if(e=this.getCoordinates()){g=e.getLength();for(var i=0;i<g;i++)b.extend(new geo.Point(e.get(i)))}break;
case "KmlCoord":case "KmlLocation":case "KmlPoint":b.extend(new geo.Point(this));break}}}});return b};l.prototype.dom.buildLookAt=s({apiInterface:"KmlLookAt",apiFactoryFn:"createLookAt",defaultProperty:"point",propertySpec:{copy:false,point:undefined,heading:null,tilt:null,range:null},constructor:function(c,b){var e=new geo.Point(b.point),g={heading:0,tilt:0,range:1E3};if(b.copy){var i=this.util.getLookAt(g.altitudeMode);g.heading=i.getHeading();g.tilt=i.getTilt();g.range=i.getRange()}b=n(b,true,
g);c.set(e.lat(),e.lng(),e.altitude(),e.altitudeMode(),b.heading,b.tilt,b.range)}});l.prototype.dom.buildCamera=s({apiInterface:"KmlCamera",apiFactoryFn:"createCamera",defaultProperty:"point",propertySpec:{copy:false,point:undefined,heading:null,tilt:null,roll:null},constructor:function(c,b){var e=new geo.Point(b.point),g={heading:0,tilt:0,roll:0};if(b.copy){var i=this.util.getCamera(g.altitudeMode);g.heading=i.getHeading();g.tilt=i.getTilt();g.roll=i.getRoll()}b=n(b,true,g);c.set(e.lat(),e.lng(),
e.altitude(),e.altitudeMode(),b.heading,b.tilt,b.roll)}});l.prototype.edit={isnamespace_:true};var f=null;l.prototype.edit.makeDraggable=function(c,b){this.edit.endDraggable(c);b=n(b,false,{bounce:true,dragCallback:null,dropCallback:null,draggingStyle:null,targetScreenOverlay:null});var e=this,g=E(e),i;i=function(m){if(f&&m.getButton()===0){google.earth.removeEventListener(e.pluginInstance.getWindow(),"mousemove",g);google.earth.removeEventListener(e.pluginInstance.getWindow(),"mouseup",i);f.dragged&&
m.preventDefault();C(e)}};var k=function(m){if(m.getButton()===0){y(e,m.getTarget());google.earth.addEventListener(e.pluginInstance.getWindow(),"mousemove",g);google.earth.addEventListener(e.pluginInstance.getWindow(),"mouseup",i)}};this.util.setJsDataValue(c,"_GEarthExtensions_dragData",{draggableOptions:b,abortAndEndFn:function(){if(f&&f.placemark.equals(c)){google.earth.removeEventListener(e.pluginInstance.getWindow(),"mousemove",g);google.earth.removeEventListener(e.pluginInstance.getWindow(),
"mouseup",i);C(e,true)}google.earth.removeEventListener(c,"mousedown",k)}});google.earth.addEventListener(c,"mousedown",k)};l.prototype.edit.endDraggable=function(c){var b=this.util.getJsDataValue(c,"_GEarthExtensions_dragData");if(b){b.abortAndEndFn.call(null);this.util.clearJsDataValue(c,"_GEarthExtensions_dragData")}};l.prototype.edit.place=function(c,b){b=n(b,false,{bounce:true,dragCallback:null,dropCallback:null,draggingStyle:null,targetScreenOverlay:null});var e=this,g=E(e);c.setVisibility(false);
var i;i=function(k){if(f&&k.getButton()===0){k.preventDefault();k.stopPropagation();google.earth.removeEventListener(e.pluginInstance.getWindow(),"mousemove",g);google.earth.removeEventListener(e.pluginInstance.getWindow(),"mousedown",i);C(e)}};this.util.setJsDataValue(c,"_GEarthExtensions_dragData",{draggableOptions:b,abortAndEndFn:function(){if(f&&f.placemark.equals(c)){google.earth.removeEventListener(e.pluginInstance.getWindow(),"mousemove",g);google.earth.removeEventListener(e.pluginInstance.getWindow(),
"mousedown",i);C(e,true)}}});y(e,c);google.earth.addEventListener(e.pluginInstance.getWindow(),"mousemove",g);google.earth.addEventListener(e.pluginInstance.getWindow(),"mousedown",i)};l.prototype.edit.drawLineString=function(c,b){b=n(b,false,{bounce:true,drawCallback:null,finishCallback:null,ensureCounterClockwise:true});var e=this.util.getJsDataValue(c,"_GEarthExtensions_lineStringEditData")||{};e&&this.edit.endEditLineString(c);var g=this,i=false,k=new geo.Polygon,m=false,o=[],t=c.getAltitudeMode(),
w=null,x=c.getType()=="KmlLinearRing",A=c.getCoordinates(),D=this.pluginInstance.parseKml('<Document><Style id="_GEarthExtensions_regularCoordinate"><IconStyle><Icon><href>http://maps.google.com/mapfiles/kml/shapes/placemark_circle.png</href></Icon><scale>0.85</scale></IconStyle></Style><Style id="_GEarthExtensions_firstCoordinateHighlight"><IconStyle><Icon><href>http://maps.google.com/mapfiles/kml/shapes/placemark_circle.png</href></Icon><scale>1.105</scale><color>ff00ff00</color></IconStyle></Style><StyleMap id="_GEarthExtensions_firstCoordinate"><Pair><key>normal</key><styleUrl>#_GEarthExtensions_regularCoordinate</styleUrl></Pair><Pair><key>highlight</key><styleUrl>#_GEarthExtensions_firstCoordinateHighlight</styleUrl></Pair></StyleMap></Document>'),
B,F=function(p){google.earth.removeEventListener(g.pluginInstance.getWindow(),"dblclick",B);var u=A.getLength();if(u&&x){var v=A.get(0);u=A.get(u-1);j(v,u)||A.pushLatLngAlt(v.getLatitude(),v.getLongitude(),v.getAltitude())}g.edit.endDraggable(w);g.dom.removeObject(D);g.util.clearJsDataValue(c,"_GEarthExtensions_lineStringEditData");o=[];m=true;b.finishCallback&&!p&&b.finishCallback.call(null)};B=function(p){p.preventDefault();F.call(null)};var r;r=function(){w=g.dom.buildPointPlacemark([0,0],{altitudeMode:t,
style:"#_GEarthExtensions_regularCoordinate",visibility:false});D.getFeatures().appendChild(w);i?o.unshift(w):o.push(w);g.edit.place(w,{bounce:b.bounce,dropCallback:function(){if(!m){var p=[w.getGeometry().getLatitude(),w.getGeometry().getLongitude(),0];i?A.unshiftLatLngAlt(p[0],p[1],p[2]):A.pushLatLngAlt(p[0],p[1],p[2]);if(b.ensureCounterClockwise){i?k.outerBoundary().prepend(p):k.outerBoundary().append(p);if(!k.isCounterClockwise()){k.outerBoundary().reverse();A.reverse();i=!i}}if(b.drawCallback)b.drawCallback.call(null,
i?0:A.getLength()-1);if(o.length==1){o[0].setStyleUrl("#_GEarthExtensions_firstCoordinate");google.earth.addEventListener(o[0],"mousedown",function(u){return function(v){i?A.unshiftLatLngAlt(u[0],u[1],u[2]):A.pushLatLngAlt(u[0],u[1],u[2]);B(v)}}(p))}setTimeout(r,0)}}})};r.call(null);google.earth.addEventListener(g.pluginInstance.getWindow(),"dblclick",B);this.pluginInstance.getFeatures().appendChild(D);this.util.setJsDataValue(c,"_GEarthExtensions_lineStringEditData",{abortAndEndFn:function(){F.call(null,
true)}})};l.prototype.edit.editLineString=function(c,b){b=n(b,false,{editCallback:null});var e=this.util.getJsDataValue(c,"_GEarthExtensions_lineStringEditData")||{};e&&this.edit.endEditLineString(c);var g=this,i=c.getType()=="KmlLinearRing",k=c.getAltitudeMode(),m=c.getCoordinates(),o=m.getLength();if(o&&i){e=m.get(0);var t=m.get(o-1);if(!j(e,t)){m.pushLatLngAlt(e.getLatitude(),e.getLongitude(),e.getAltitude());o++}}var w=this.pluginInstance.parseKml('<Document><Style id="_GEarthExtensions_regularCoordinate"><IconStyle><Icon><href>http://maps.google.com/mapfiles/kml/shapes/placemark_circle.png</href></Icon><color>ffffffff</color><scale>0.85</scale></IconStyle></Style><StyleMap id="_GEarthExtensions_midCoordinate"><Pair><key>normal</key><Style><IconStyle><Icon><href>http://maps.google.com/mapfiles/kml/shapes/placemark_circle.png</href></Icon><color>60ffffff</color><scale>0.6</scale></IconStyle></Style></Pair><Pair><key>highlight</key><styleUrl>#_GEarthExtensions_regularCoordinate</styleUrl></Pair></StyleMap></Document>'),
x=[],A=function(){if(i)if(o==3)x[1].rightMidPlacemark.setVisibility(false);else o>=4&&x[o-2].rightMidPlacemark.setVisibility(true)},D=function(r){return function(p){p.preventDefault();p=null;if(r.index>0||i){p=r.index-1;if(p<0)p+=o;i&&r.index===0&&p--;p=x[p]}for(d=r.index;d<o-1;d++)m.set(d,m.get(d+1));m.pop();i&&r.index===0&&m.set(o-2,m.get(0));o--;if(!r.rightMidPlacemark&&p){g.edit.endDraggable(p.rightMidPlacemark);g.dom.removeObject(p.rightMidPlacemark);p.rightMidPlacemark=null}if(r.rightMidPlacemark){g.edit.endDraggable(r.rightMidPlacemark);
g.dom.removeObject(r.rightMidPlacemark)}g.edit.endDraggable(r.regularPlacemark);google.earth.removeEventListener(r.regularPlacemark,"dblclick",r.deleteEventListener);g.dom.removeObject(r.regularPlacemark);x.splice(r.index,1);for(d=0;d<o;d++)x[d].index=d;p&&p.regularDragCallback.call(p.regularPlacemark,p);A();b.editCallback&&b.editCallback(null)}},B=function(r){return function(){m.setLatLngAlt(r.index,this.getGeometry().getLatitude(),this.getGeometry().getLongitude(),this.getGeometry().getAltitude());
if(i&&o>=2&&r.index===0){var p=m.get(0);p=m.get(o-1);m.setLatLngAlt(0,this.getGeometry().getLatitude(),this.getGeometry().getLongitude(),this.getGeometry().getAltitude());m.setLatLngAlt(o-1,this.getGeometry().getLatitude(),this.getGeometry().getLongitude(),this.getGeometry().getAltitude())}p=m.get(r.index);if(r.index>0||i){var u=r.index-1;if(u<0)u+=o;i&&r.index===0&&u--;var v=(new geo.Point(m.get(u))).midpoint(new geo.Point(p));x[u].rightMidPlacemark.getGeometry().setLatitude(v.lat());x[u].rightMidPlacemark.getGeometry().setLongitude(v.lng());
x[u].rightMidPlacemark.getGeometry().setAltitude(v.altitude())}if(r.index<o-1||i){u=i&&r.index==o-2||!i&&r.index==o-1?m.get(0):m.get(r.index+1);p=(new geo.Point(p)).midpoint(new geo.Point(u));r.rightMidPlacemark.getGeometry().setLatitude(p.lat());r.rightMidPlacemark.getGeometry().setLongitude(p.lng());r.rightMidPlacemark.getGeometry().setAltitude(p.altitude())}A();b.editCallback&&b.editCallback(null)}},F=function(r){var p=false,u=null;return function(){if(!p){p=true;var v;this.setStyleUrl("#_GEarthExtensions_regularCoordinate");
m.push(m.get(o-1));for(v=o-1;v>r.index+1;v--)m.set(v,m.get(v-1));o++;u={};u.index=r.index+1;u.regularPlacemark=this;r.rightMidPlacemark=g.dom.buildPointPlacemark({point:m.get(r.index),altitudeMode:k,style:"#_GEarthExtensions_midCoordinate"});w.getFeatures().appendChild(r.rightMidPlacemark);g.edit.makeDraggable(r.rightMidPlacemark,{bounce:false,dragCallback:F(r)});u.rightMidPlacemark=g.dom.buildPointPlacemark({point:m.get(r.index),altitudeMode:k,style:"#_GEarthExtensions_midCoordinate"});w.getFeatures().appendChild(u.rightMidPlacemark);
g.edit.makeDraggable(u.rightMidPlacemark,{bounce:false,dragCallback:F(u)});u.deleteEventListener=D(u);google.earth.addEventListener(this,"dblclick",u.deleteEventListener);u.regularDragCallback=B(u);x.splice(u.index,0,u);for(v=0;v<o;v++)x[v].index=v}u.regularDragCallback.call(this,u)}};g.util.batchExecute(function(){for(var r=0;r<o;r++){var p=m.get(r),u=m.get((r+1)%o),v={};x.push(v);v.index=r;if(!(i&&r==o-1)){v.regularPlacemark=g.dom.buildPointPlacemark(p,{altitudeMode:k,style:"#_GEarthExtensions_regularCoordinate"});
w.getFeatures().appendChild(v.regularPlacemark);v.regularDragCallback=B(v);g.edit.makeDraggable(v.regularPlacemark,{bounce:false,dragCallback:v.regularDragCallback});v.deleteEventListener=D(v);google.earth.addEventListener(v.regularPlacemark,"dblclick",v.deleteEventListener);if(r<o-1||i){v.rightMidPlacemark=g.dom.buildPointPlacemark({point:(new geo.Point(p)).midpoint(new geo.Point(u)),altitudeMode:k,style:"#_GEarthExtensions_midCoordinate"});w.getFeatures().appendChild(v.rightMidPlacemark);g.edit.makeDraggable(v.rightMidPlacemark,
{bounce:false,dragCallback:F(v)})}}}A();g.pluginInstance.getFeatures().appendChild(w)});g.util.setJsDataValue(c,"_GEarthExtensions_lineStringEditData",{innerDoc:w,abortAndEndFn:function(){g.util.batchExecute(function(){var r=m.getLength();if(r&&i){var p=m.get(0);r=m.get(r-1);j(p,r)||m.pushLatLngAlt(p.getLatitude(),p.getLongitude(),p.getAltitude())}for(p=0;p<x.length;p++)if(x[p].regularPlacemark){google.earth.removeEventListener(x[p].regularPlacemark,"dblclick",x[p].deleteEventListener);g.edit.endDraggable(x[p].regularPlacemark);
x[p].rightMidPlacemark&&g.edit.endDraggable(x[p].rightMidPlacemark)}g.dom.removeObject(w)})}})};l.prototype.edit.endEditLineString=function(c){var b=this.util.getJsDataValue(c,"_GEarthExtensions_lineStringEditData");if(b){b.abortAndEndFn.call(null);this.util.clearJsDataValue(c,"_GEarthExtensions_lineStringEditData")}};l.prototype.fx={isnamespace_:true};l.prototype.fx.AnimationManager_=q(function(){this.extInstance=arguments.callee.extInstance_;this.animations_=[];this.running_=false;this.globalTime_=
0});l.prototype.fx.AnimationManager_.prototype.startAnimation=function(c){this.animations_.push({obj:c,startGlobalTime:this.globalTime_});this.start_()};l.prototype.fx.AnimationManager_.prototype.stopAnimation=function(c){for(var b=0;b<this.animations_.length;b++)if(this.animations_[b].obj==c){this.animations_.splice(b,1);return}};l.prototype.fx.AnimationManager_.prototype.start_=function(){if(!this.running_){this.startTimeStamp_=Number(new Date);this.tick_();for(var c=0;c<this.animations_.length;c++)this.animations_[c].obj.renderFrame(0);
var b=this;this.frameendListener_=function(){b.tick_()};this.tickInterval_=window.setInterval(this.frameendListener_,100);google.earth.addEventListener(this.extInstance.pluginInstance,"frameend",this.frameendListener_);this.running_=true}};l.prototype.fx.AnimationManager_.prototype.stop_=function(){if(this.running_){google.earth.removeEventListener(this.extInstance.pluginInstance,"frameend",this.frameendListener_);this.frameendListener_=null;window.clearInterval(this.tickInterval_);this.tickInterval_=
null;this.running_=false;this.globalTime_=0}};l.prototype.fx.AnimationManager_.prototype.tick_=function(){if(this.running_){this.globalTime_=Number(new Date)-this.startTimeStamp_;this.renderCurrentFrame_()}};l.prototype.fx.AnimationManager_.prototype.renderCurrentFrame_=function(){for(var c=this.animations_.length-1;c>=0;c--){var b=this.animations_[c];b.obj.renderFrame(this.globalTime_-b.startGlobalTime)}this.animations_.length===0&&this.stop_()};l.prototype.fx.getAnimationManager_=function(){if(!this.fx.animationManager_)this.fx.animationManager_=
new this.fx.AnimationManager_;return this.fx.animationManager_};l.prototype.fx.Animation=q(function(c,b){this.extInstance=arguments.callee.extInstance_;this.renderFn=c;this.completionFn=b||function(){}});l.prototype.fx.Animation.prototype.start=function(){this.extInstance.fx.getAnimationManager_().startAnimation(this)};l.prototype.fx.Animation.prototype.stop=function(c){this.extInstance.fx.getAnimationManager_().stopAnimation(this);this.completionFn({cancelled:!Boolean(c||geo.util.isUndefined(c))})};
l.prototype.fx.Animation.prototype.rewind=function(){this.renderFrame(0);this.stop(false)};l.prototype.fx.Animation.prototype.renderFrame=function(c){this.renderFn.call(this,c)};l.prototype.fx.TimedAnimation=q([l.prototype.fx.Animation],function(c,b,e){this.extInstance=arguments.callee.extInstance_;this.duration=c;this.renderFn=b;this.complete=false;this.completionFn=e||function(){}});l.prototype.fx.TimedAnimation.prototype.renderFrame=function(c){if(!this.complete)if(c>this.duration){this.renderFn.call(this,
this.duration);this.stop();this.complete=true}else this.renderFn.call(this,c)};l.prototype.fx.bounce=function(c,b){b=n(b,false,{duration:300,startAltitude:null,altitude:this.util.getCamera().getAltitude()/5,phase:null,repeat:0,dampen:0.3,callback:function(){}});var e=this;this.fx.rewind(c);if(false in c||!c.getGeometry()||c.getGeometry().getType()!="KmlPoint")throw new TypeError("Placemark must be a KmlPoint geometry");var g=c.getGeometry(),i=g.getAltitudeMode();if(i==this.pluginInstance.ALTITUDE_CLAMP_TO_GROUND){g.setAltitude(0);
g.setAltitudeMode(this.pluginInstance.ALTITUDE_RELATIVE_TO_GROUND)}if(i==this.pluginInstance.ALTITUDE_CLAMP_TO_SEA_FLOOR){g.setAltitude(0);g.setAltitudeMode(this.pluginInstance.ALTITUDE_RELATIVE_TO_SEA_FLOOR)}if(typeof b.startAltitude!="number")b.startAltitude=g.getAltitude();var k,m;k=function(){e.fx.animateProperty(g,"altitude",{duration:b.duration/2,end:b.startAltitude+b.altitude,easing:"out",featureProxy:c,callback:m||function(){}})};m=function(o){o&&o.cancelled||e.fx.animateProperty(g,"altitude",
{duration:b.duration/2,start:b.startAltitude+b.altitude,end:b.startAltitude,easing:"in",featureProxy:c,callback:function(t){g.setAltitudeMode(i);if(t.cancelled){g.setAltitude(b.startAltitude);b.callback.call(c,t)}else if(b.repeat>=1){--b.repeat;b.altitude*=b.dampen;b.duration*=Math.sqrt(b.dampen);b.phase=0;e.fx.bounce(c,b)}else b.callback.call(c,t)}})};if(b.phase===1){m=null;k.call()}else b.phase===2?m.call():k.call()};l.prototype.fx.cancel=function(c){c=this.util.getJsDataValue(c,"_GEarthExtensions_anim")||
[];for(var b=0;b<c.length;b++)c[b].stop(false)};l.prototype.fx.rewind=function(c){c=this.util.getJsDataValue(c,"_GEarthExtensions_anim")||[];for(var b=0;b<c.length;b++)c[b].rewind()};l.prototype.fx.animateProperty=function(c,b,e){e=n(e,false,{duration:500,start:null,end:null,delta:null,easing:"none",callback:null,featureProxy:null});if(typeof e.easing=="string")e.easing={none:function(t){return t},"in":function(t){return t*t*t},out:function(t){var w=t*t,x=w*t;return x-3*w+3*t},both:function(t){var w=
t*t;t=w*t;return 6*t*w-15*w*w+10*t}}[e.easing];var g=b.charAt(0).toUpperCase()+b.substr(1),i=this,k;if(b=="color"){if(e.delta)throw Error("Cannot use delta with color animations.");var m=c.getColor()||{get:function(){return""}};if(!e.start)e.start=m.get();if(!e.end)e.end=m.get();k=function(t){m.set(i.util.blendColors(e.start,e.end,e.easing.call(null,t)))}}else{b=function(){return i.util.callMethod(c,"get"+g)};if(!isFinite(e.start)&&!isFinite(e.end)){if(!isFinite(e.delta))e.delta=0;e.start=b();e.end=
b()+e.delta}else{if(!isFinite(e.start))e.start=b();if(!isFinite(e.end))e.end=b()}k=function(t){t=e.start+(e.end-e.start)*e.easing.call(null,t);i.util.callMethod(c,"set"+g,t)}}b=new this.fx.TimedAnimation(e.duration,function(t){k(1*t/e.duration)},function(t){var w=i.util.getJsDataValue(e.featureProxy||c,"_GEarthExtensions_anim");if(w){for(var x=0;x<w.length;x++)if(w[x]==this){w.splice(x,1);break}w.length||i.util.clearJsDataValue(e.featureProxy||c,"_GEarthExtensions_anim")}e.callback&&e.callback.call(c,
t)});var o=this.util.getJsDataValue(e.featureProxy||c,"_GEarthExtensions_anim");o?o.push(b):this.util.setJsDataValue(e.featureProxy||c,"_GEarthExtensions_anim",[b]);b.start();return b};l.prototype.math3d={isnamespace_:true};l.prototype.math3d.htrToLocalFrame=function(c){var b=[c[0].toRadians(),c[1].toRadians(),c[2].toRadians()];c=2;var e=0,g=1,i=[[0,0,0],[0,0,0],[0,0,0]],k=Math.cos(b[0]),m=Math.cos(b[1]),o=Math.cos(b[2]),t=Math.sin(b[0]),w=Math.sin(b[1]);b=Math.sin(b[2]);var x=k*o,A=k*b,D=t*o,B=t*
b;i[c][c]=m*o;i[c][e]=w*D-A;i[c][g]=w*x+B;i[e][c]=m*b;i[e][e]=w*B+x;i[e][g]=w*A-D;i[g][c]=-w;i[g][e]=m*t;i[g][g]=m*k;return c=new geo.linalg.Matrix(i)};l.prototype.math3d.localFrameToHtr=function(c){c=c;var b=3,e=1,g=2,i=Math.sqrt(c.e(b,b)*c.e(b,b)+c.e(e,b)*c.e(e,b));c=i<=1.6E-5?[Math.atan2(-c.e(e,g),c.e(e,e)),Math.atan2(-c.e(g,b),i),0]:[Math.atan2(c.e(g,e),c.e(g,g)),Math.atan2(-c.e(g,b),i),Math.atan2(c.e(e,b),c.e(b,b))];return[c[0].toDegrees(),c[1].toDegrees(),c[2].toDegrees()]};l.prototype.math3d.makeOrthonormalFrame=
function(c,b){var e=c.cross(b).toUnitVector();if(e.eql(geo.linalg.Vector.Zero(3)))return null;var g=b.cross(e).toUnitVector(),i=e.cross(g);return new geo.linalg.Matrix([e.elements,g.elements,i.elements])};l.prototype.math3d.makeLocalToGlobalFrame=function(c){c=c.toCartesian().toUnitVector();var b=(new geo.linalg.Vector([0,1,0])).cross(c).toUnitVector(),e=c.cross(b).toUnitVector();return new geo.linalg.Matrix([b.elements,e.elements,c.elements])};l.prototype.util={isnamespace_:true};l.NAMED_COLORS=
{aqua:"ffffff00",black:"ff000000",blue:"ffff0000",fuchsia:"ffff00ff",gray:"ff808080",green:"ff008000",lime:"ff00ff00",maroon:"ff000080",navy:"ff800000",olive:"ff008080",purple:"ff800080",red:"ff0000ff",silver:"ffc0c0c0",teal:"ff808000",white:"ffffffff",yellow:"ff00ffff"};l.prototype.util.parseColor=function(c,b){var e=function(i){return(i.length<2?"0":"")+i};if(geo.util.isArray(c))return e(c.length>=4?c[3].toString(16):"ff")+e(c[2].toString(16))+e(c[1].toString(16))+e(c[0].toString(16));else if(typeof c==
"string"){if(c.toLowerCase()in l.NAMED_COLORS)return l.NAMED_COLORS[c.toLowerCase()];if(c.length>7)return c.match(/^[0-9a-f]{8}$/i)?c:null;else{var g=null;g=c.length>4?c.replace(/#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})/i,"ff$3$2$1").toLowerCase():c.replace(/#?([0-9a-f])([0-9a-f])([0-9a-f])/i,"ff$3$3$2$2$1$1").toLowerCase();if(g==c)return null;geo.util.isUndefined(b)||(g=e(Math.floor(255*b).toString(16))+g.substring(2));return g}}return null};l.prototype.util.blendColors=function(c,b,e){if(geo.util.isUndefined(e)||
e===null)e=0.5;c=this.util.parseColor(c);b=this.util.parseColor(b);var g=function(i,k){i=parseInt(i,16);k=parseInt(k,16);var m;m=Math.floor((k-i)*e+i).toString(16);return m=(m.length<2?"0":"")+m};return g(c.substr(0,2),b.substr(0,2))+g(c.substr(2,2),b.substr(2,2))+g(c.substr(4,2),b.substr(4,2))+g(c.substr(6,2),b.substr(6,2))};var h={};l.prototype.util.hasJsData=function(c){return z(c)?true:false};l.prototype.util.clearAllJsData=function(c){(c=z(c))&&delete h[c]};l.prototype.util.getJsDataValue=function(c,
b){var e=z(c);if(e&&b in h[e].data)return h[e].data[b]};l.prototype.util.setJsDataValue=function(c,b,e){var g=z(c);if(!g){for(g=null;!g||g in h;){g=[];var i="0123456789ABCDEF",k=0;for(k=0;k<36;k++)g[k]=Math.floor(Math.random()*16);g[14]=4;g[19]=g[19]&3|8;for(k=0;k<36;k++)g[k]=i.charAt(g[k]);g[8]=g[13]=g[18]=g[23]="-";g=g.join("")}h[g]={object:c,data:{}}}h[g].data[b]=e};l.prototype.util.clearJsDataValue=function(c,b){var e=z(c);if(e&&b in h[e].data){delete h[e].data[b];for(var g in h[e].data)return;
this.util.clearAllJsData(c)}};l.prototype.util.displayKml=function(c,b){b=n(b,false,{cacheBuster:false,flyToView:false,flyToBoundsFallback:true,aspectRatio:1});if(b.cacheBuster)c+=(c.match(/\?/)?"&":"?")+"_cacheBuster="+Number(new Date).toString();var e=this;google.earth.fetchKml(e.pluginInstance,c,function(g){if(g){e.pluginInstance.getFeatures().appendChild(g);b.flyToView&&e.util.flyToObject(g,{boundsFallback:b.flyToBoundsFallback,aspectRatio:b.aspectRatio})}})};l.prototype.util.displayKmlString=
function(c,b){b=n(b,false,{flyToView:false,flyToBoundsFallback:true,aspectRatio:1});var e=this.pluginInstance.parseKml(c);if(e){this.pluginInstance.getFeatures().appendChild(e);b.flyToView&&this.util.flyToObject(e,{boundsFallback:b.flyToBoundsFallback,aspectRatio:b.aspectRatio})}return e};l.prototype.util.lookAt=function(){this.pluginInstance.getView().setAbstractView(this.dom.buildLookAt.apply(null,arguments))};l.prototype.util.getLookAt=function(c){if(geo.util.isUndefined(c))c=this.pluginInstance.ALTITUDE_ABSOLUTE;
return this.pluginInstance.getView().copyAsLookAt(c)};l.prototype.util.getCamera=function(c){if(geo.util.isUndefined(c))c=this.pluginInstance.ALTITUDE_ABSOLUTE;return this.pluginInstance.getView().copyAsCamera(c)};l.prototype.util.flyToObject=function(c,b){b=n(b,false,{boundsFallback:true,aspectRatio:1});if(!c)throw Error("flyToObject was given an invalid object.");if("getAbstractView"in c&&c.getAbstractView())this.pluginInstance.getView().setAbstractView(c.getAbstractView());else if(b.boundsFallback){var e=
this.dom.computeBounds(c);e&&!e.isEmpty()&&this.view.setToBoundsView(e,{aspectRatio:b.aspectRatio})}};l.prototype.util.batchExecute=function(c,b){var e=this;google.earth.executeBatch(this.pluginInstance,function(){c.call(e,b)})};l.prototype.util.callMethod=function(c,b){var e,g=[];for(e=2;e<arguments.length;e++)g.push(arguments[e]);if(typeof c[b]=="function")return c[b].apply(c,g);else{var i=[];for(e=0;e<g.length;e++)i.push("args["+e+"]");return window.eval("object."+b+"("+i.join(",")+")")}};l.prototype.util.takeOverCamera=
function(c){if(c||geo.util.isUndefined(c)){if(!this.cameraControlOldProps_){this.cameraControlOldProps_={flyToSpeed:this.pluginInstance.getOptions().getFlyToSpeed(),mouseNavEnabled:this.pluginInstance.getOptions().getMouseNavigationEnabled(),navControlVis:this.pluginInstance.getNavigationControl().getVisibility()};this.pluginInstance.getOptions().setFlyToSpeed(this.pluginInstance.SPEED_TELEPORT);this.pluginInstance.getOptions().setMouseNavigationEnabled(false);this.pluginInstance.getNavigationControl().setVisibility(this.pluginInstance.VISIBILITY_HIDE)}}else if(this.cameraControlOldProps_){this.pluginInstance.getOptions().setFlyToSpeed(this.cameraControlOldProps_.flyToSpeed);
this.pluginInstance.getOptions().setMouseNavigationEnabled(this.cameraControlOldProps_.mouseNavEnabled);this.pluginInstance.getNavigationControl().setVisibility(this.cameraControlOldProps_.navControlVis);delete this.cameraControlOldProps_}};l.prototype.util.encodeArray=function(c){for(var b="",e=0;e<c.length;e++){var g=c[e]<<1;for(g=c[e]<0?~g:g;g>=32;){b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".charAt(32|g&31);g>>=5}b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".charAt(g)}return b};
l.prototype.util.decodeArray=function(c){for(var b=c.length,e=0,g=[];e<b;){var i,k=0,m=0;do{i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".indexOf(c.charAt(e++));m|=(i&31)<<k;k+=5}while(i>=32);g.push(m&1?~(m>>1):m>>1)}return g};l.prototype.view={isnamespace_:true};l.prototype.view.createBoundsView=function(c,b){b=n(b,false,{aspectRatio:undefined,defaultRange:1E3,scaleRange:1.5});var e=c.center(),g=b.defaultRange,i=c.span();if(i.lat||i.lng){i=(new geo.Point(e.lat(),c.east())).distance(new geo.Point(e.lat(),
c.west()));var k=(new geo.Point(c.north(),e.lng())).distance(new geo.Point(c.south(),e.lng()));g=Math.min(Math.max(b.aspectRatio,i/k),1);g=(45/(g+0.4)-2).toRadians();i=Math.max(k,i);i=Math.min((90).toRadians(),g+i/(2*geo.math.EARTH_RADIUS));g=b.scaleRange*geo.math.EARTH_RADIUS*(Math.sin(i)*Math.sqrt(1+1/Math.pow(Math.tan(g),2))-1)}return this.dom.buildLookAt(new geo.Point(e.lat(),e.lng(),c.top(),c.northEastTop().altitudeMode()),{range:g})};l.prototype.view.setToBoundsView=function(){this.pluginInstance.getView().setAbstractView(this.view.createBoundsView.apply(this,
arguments))};l.prototype.view.serialize=function(){var c=this.pluginInstance.getView().copyAsCamera(this.pluginInstance.ALTITUDE_ABSOLUTE);c={lat:c.getLatitude(),lng:c.getLongitude(),altitude:c.getAltitude(),heading:c.getHeading(),tilt:c.getTilt(),roll:c.getRoll()};var b=Math.floor(c.altitude*10);c=this.util.encodeArray([Math.floor(geo.math.constrainValue(c.lat,[-90,90])*1E5),Math.floor(geo.math.wrapValue(c.lng,[-180,180])*1E5),Math.floor(b/1073741824),b>=0?b%1073741824:1073741824-Math.abs(b)%1073741824,
Math.floor(geo.math.wrapValue(c.heading,[0,360])*10),Math.floor(geo.math.wrapValue(c.tilt,[0,180])*10),Math.floor(geo.math.wrapValue(c.roll,[-180,180])*10)]);return"0"+c};l.prototype.view.deserialize=function(c){if(c.charAt(0)!="0")throw Error("Invalid serialized view string.");c=c.substr(1);c=this.util.decodeArray(c);c={lat:geo.math.constrainValue(c[0]*1.0E-5,[-90,90]),lng:geo.math.wrapValue(c[1]*1.0E-5,[-180,180]),altitude:(1073741824*c[2]+c[3])*0.1,heading:geo.math.wrapValue(c[4]*0.1,[0,360]),
tilt:geo.math.wrapValue(c[5]*0.1,[0,180]),roll:geo.math.wrapValue(c[6]*0.1,[-180,180])};var b=this.pluginInstance.createCamera("");b.set(c.lat,c.lng,c.altitude,this.pluginInstance.ALTITUDE_ABSOLUTE,c.heading,c.tilt,c.roll);this.pluginInstance.getView().setAbstractView(b)};l.prototype.util.serializeView=l.prototype.view.serialize;l.prototype.util.deserializeView=l.prototype.view.deserialize;l.prototype.view.createVantageView=function(c,b){c=new geo.Point(c);b=new geo.Point(b);var e=c.heading(b),g=
0,i=c.toCartesian(),k=b.toCartesian();g=this.math3d.makeLocalToGlobalFrame(c);i=k.subtract(i).toUnitVector();g=(new geo.linalg.Vector(g.elements[2])).multiply(-1);g=Math.acos(g.dot(i)).toDegrees();return this.dom.buildCamera(c,{heading:e,tilt:g})};window.GEarthExtensions=l})();
